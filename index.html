<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ENIGMA - Personnalisation temps r√©el</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ENIGMA">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { height: 100vh; overflow: hidden; color: white; }

        @keyframes auraPulse {
            0% { text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor; }
            50% { text-shadow: 0 0 20px currentColor, 0 0 30px currentColor, 0 0 40px currentColor; }
            100% { text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor; }
        }

        .app-title-wrapper {
            position: absolute;
            top: 28%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: inline-block;
            will-change: transform;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        .app-title {
            font-family: 'Georgia', 'Times New Roman', serif !important;
            font-size: 68px !important;
            font-weight: bold;
            letter-spacing: 8px;
            text-transform: uppercase;
            padding-bottom: 15px;
            display: flex;
            justify-content: center;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.5));            transform: translateZ(0);
            will-change: transform, text-shadow, color;
            backface-visibility: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            line-height: 1.1;
        }

        .app-title .letter {
            display: inline-block;
            color: #FFD700;
            text-shadow: 
                0 0 8px rgba(255, 215, 0, 0.6),
                0 0 18px rgba(255, 215, 0, 0.4),
                0 0 28px rgba(255, 215, 0, 0.25);
            animation: letterGoldWave 3.2s cubic-bezier(0.4, 0, 0.2, 1) infinite,
                       letterGoldPulse 4.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            animation-delay: calc(var(--i) * 0.1s);
            position: relative;
            transform: translateZ(0);
            will-change: transform, text-shadow, color;
            backface-visibility: hidden;
            pointer-events: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            font-family: inherit;
            font-size: inherit;
        }

        @keyframes letterGoldPulse {
            0%, 100% {
                text-shadow: 
                    0 0 8px rgba(255, 215, 0, 0.6),
                    0 0 18px rgba(255, 215, 0, 0.4),
                    0 0 28px rgba(255, 215, 0, 0.25);
            }
            50% {
                text-shadow: 
                    0 0 15px rgba(255, 215, 0, 0.9),
                    0 0 30px rgba(255, 215, 0, 0.7),
                    0 0 50px rgba(255, 200, 0, 0.5),
                    0 0 70px rgba(255, 215, 0, 0.35);
            }
        }
        @keyframes letterGoldWave {
            0%, 100% {
                color: #FFD700;
                transform: translateY(0) scale(1);
            }
            50% {
                color: #FFFFE0;
                text-shadow: 
                    0 0 20px rgba(255, 215, 0, 1),
                    0 0 40px rgba(255, 215, 0, 0.85),
                    0 0 65px rgba(255, 200, 0, 0.65),
                    0 0 90px rgba(255, 215, 0, 0.45),
                    0 0 120px rgba(255, 215, 0, 0.25);
                transform: translateY(-7px) scale(1.03);
            }
        }

        .particle {
            position: absolute;
            background: #FFD700;
            border-radius: 50%;
            opacity: 0;
            box-shadow: 
                0 0 10px #FFD700, 
                0 0 22px #FFA500,
                0 0 35px rgba(255, 215, 0, 0.6),
                0 0 50px rgba(255, 200, 0, 0.35);
            pointer-events: none;
            transform: translateZ(0);
            will-change: transform, opacity;
            backface-visibility: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .particle:nth-child(1) { width: 4px; height: 4px; top: -10px; left: 10%; animation: particleFloat 3.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0s; }
        .particle:nth-child(2) { width: 3px; height: 3px; top: 20px; left: 85%; animation: particleFloat 4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.4s; }
        .particle:nth-child(3) { width: 5px; height: 5px; top: -5px; left: 50%; animation: particleFloat 4.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.8s; }
        .particle:nth-child(4) { width: 3px; height: 3px; top: 35px; left: 20%; animation: particleFloat 3.7s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.2s; }
        .particle:nth-child(5) { width: 4px; height: 4px; top: 10px; left: 70%; animation: particleFloat 4.2s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.6s; }
        .particle:nth-child(6) { width: 3px; height: 3px; top: -15px; left: 35%; animation: particleFloat 4.7s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.6s; }
        .particle:nth-child(7) { width: 4px; height: 4px; top: 25px; left: 5%; animation: particleFloat 3.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.2s; }
        .particle:nth-child(8) { width: 3px; height: 3px; top: -8px; left: 90%; animation: particleFloat 4.1s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1s; }
        .particle:nth-child(9) { width: 5px; height: 5px; top: 15px; left: 45%; animation: particleFloat 5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.5s; }
        .particle:nth-child(10) { width: 3px; height: 3px; top: -12px; left: 60%; animation: particleFloat 3.9s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.5s; }
        .particle:nth-child(11) { width: 4px; height: 4px; top: 30px; left: 80%; animation: particleFloat 4.4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.7s; }
        .particle:nth-child(12) { width: 3px; height: 3px; top: -6px; left: 25%; animation: particleFloat 4.6s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.3s; }        .particle:nth-child(13) { width: 4px; height: 4px; top: -20px; left: 15%; animation: particleFloat 4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.1s; }
        .particle:nth-child(14) { width: 3px; height: 3px; top: 40px; left: 95%; animation: particleFloat 4.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.9s; }
        .particle:nth-child(15) { width: 5px; height: 5px; top: -3px; left: 40%; animation: particleFloat 3.6s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.3s; }
        .particle:nth-child(16) { width: 3px; height: 3px; top: 28px; left: 3%; animation: particleFloat 4.9s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.4s; }
        .particle:nth-child(17) { width: 4px; height: 4px; top: -18px; left: 75%; animation: particleFloat 4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.25s; }
        .particle:nth-child(18) { width: 3px; height: 3px; top: 45px; left: 55%; animation: particleFloat 5.1s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.7s; }
        .particle:nth-child(19) { width: 5px; height: 5px; top: -7px; left: 30%; animation: particleFloat 3.7s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0s; }
        .particle:nth-child(20) { width: 3px; height: 3px; top: 38px; left: 65%; animation: particleFloat 4.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.1s; }
        .particle:nth-child(21) { width: 4px; height: 4px; top: -14px; left: 88%; animation: particleFloat 4.2s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.45s; }
        .particle:nth-child(22) { width: 3px; height: 3px; top: 42px; left: 12%; animation: particleFloat 5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.55s; }
        .particle:nth-child(23) { width: 5px; height: 5px; top: -9px; left: 52%; animation: particleFloat 3.9s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.65s; }
        .particle:nth-child(24) { width: 3px; height: 3px; top: 33px; left: 78%; animation: particleFloat 4.7s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.35s; }
        .particle:nth-child(25) { width: 4px; height: 4px; top: -25px; left: 22%; animation: particleFloat 4.3s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.15s; }
        .particle:nth-child(26) { width: 3px; height: 3px; top: 48px; left: 8%; animation: particleFloat 5.2s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.85s; }
        .particle:nth-child(27) { width: 5px; height: 5px; top: -2px; left: 68%; animation: particleFloat 3.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.55s; }
        .particle:nth-child(28) { width: 3px; height: 3px; top: 36px; left: 92%; animation: particleFloat 4.6s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.25s; }
        .particle:nth-child(29) { width: 4px; height: 4px; top: -16px; left: 44%; animation: particleFloat 4.1s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.35s; }
        .particle:nth-child(30) { width: 3px; height: 3px; top: 44px; left: 58%; animation: particleFloat 5.3s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.65s; }
        .particle:nth-child(31) { width: 5px; height: 5px; top: -11px; left: 34%; animation: particleFloat 3.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.05s; }
        .particle:nth-child(32) { width: 3px; height: 3px; top: 32px; left: 76%; animation: particleFloat 4.4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.45s; }
        .particle:nth-child(33) { width: 4px; height: 4px; top: -19px; left: 62%; animation: particleFloat 4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.75s; }
        .particle:nth-child(34) { width: 3px; height: 3px; top: 46px; left: 18%; animation: particleFloat 5.1s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.05s; }
        .particle:nth-child(35) { width: 5px; height: 5px; top: -4px; left: 50%; animation: particleFloat 3.7s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.95s; }
        .particle:nth-child(36) { width: 3px; height: 3px; top: 39px; left: 82%; animation: particleFloat 4.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.85s; }
        .particle:nth-child(37) { width: 4px; height: 4px; top: -13px; left: 28%; animation: particleFloat 4.2s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.22s; }
        .particle:nth-child(38) { width: 3px; height: 3px; top: 41px; left: 72%; animation: particleFloat 4.9s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.12s; }
        .particle:nth-child(39) { width: 5px; height: 5px; top: -8px; left: 46%; animation: particleFloat 3.6s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.42s; }
        .particle:nth-child(40) { width: 3px; height: 3px; top: 37px; left: 14%; animation: particleFloat 5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.52s; }
        .particle:nth-child(41) { width: 4px; height: 4px; top: -21px; left: 86%; animation: particleFloat 4.4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.62s; }
        .particle:nth-child(42) { width: 3px; height: 3px; top: 43px; left: 4%; animation: particleFloat 5.2s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.72s; }
        .particle:nth-child(43) { width: 5px; height: 5px; top: -6px; left: 56%; animation: particleFloat 3.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.18s; }
        .particle:nth-child(44) { width: 3px; height: 3px; top: 34px; left: 94%; animation: particleFloat 4.7s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.38s; }
        .particle:nth-child(45) { width: 4px; height: 4px; top: -17px; left: 38%; animation: particleFloat 4.1s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.52s; }
        .particle:nth-child(46) { width: 3px; height: 3px; top: 47px; left: 66%; animation: particleFloat 5.4s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.92s; }
        .particle:nth-child(47) { width: 5px; height: 5px; top: -10px; left: 24%; animation: particleFloat 3.9s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 0.32s; }
        .particle:nth-child(48) { width: 3px; height: 3px; top: 31px; left: 79%; animation: particleFloat 4.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; animation-delay: 1.62s; }

        @keyframes particleFloat {
            0% { opacity: 0; transform: translateY(0) scale(0.5) rotate(0deg); }
            15% { opacity: 0.85; }
            50% { opacity: 1; }
            85% { opacity: 0.7; }
            100% { opacity: 0; transform: translateY(-80px) scale(1.4) rotate(180deg); }
        }

        .app-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #FFD700, #FFEC8B, #FFD700, transparent);
            box-shadow: 0 0 12px #FFD700, 0 0 25px rgba(255, 215, 0, 0.6), 0 0 40px rgba(255, 200, 0, 0.35);
            opacity: 0;
            animation: soulignementAnim 1.8s cubic-bezier(0.4, 0, 0.2, 1) forwards, 
                       waveGlow 2.5s cubic-bezier(0.4, 0, 0.2, 1) infinite 1.8s;
            transform: translateX(-50%) translateZ(0);
            will-change: width, opacity, box-shadow;
            backface-visibility: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @keyframes soulignementAnim {
            0% { width: 0; opacity: 0; }
            50% { width: 100%; opacity: 1; }
            100% { width: 100%; opacity: 0.85; }
        }

        @keyframes waveGlow {
            0%, 100% { opacity: 0.65; box-shadow: 0 0 12px #FFD700, 0 0 25px rgba(255, 215, 0, 0.5); }
            50% { opacity: 1; box-shadow: 0 0 22px #FFD700, 0 0 42px rgba(255, 215, 0, 0.8), 0 0 65px rgba(255, 200, 0, 0.55); }
        }

        .app-title-wrapper::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(0);
            width: 125%;
            height: 155%;
            background: radial-gradient(ellipse at center, 
                        rgba(255, 215, 0, 0.08) 0%, 
                        rgba(255, 200, 0, 0.05) 40%, 
                        transparent 72%);
            z-index: 1;
            animation: ambientGlow 5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            pointer-events: none;
            will-change: opacity, transform;
            backface-visibility: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        @keyframes ambientGlow {
            0%, 100% { opacity: 0.45; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.9; transform: translate(-50%, -50%) scale(1.06); }
        }

        @media (max-width: 768px) {
            .app-title { font-size: 48px; letter-spacing: 5px; }
            .particle { width: 3px; height: 3px; }
        }
        @media (max-width: 500px) { .particle:nth-child(n+37) { display: none; } }
        @media (max-width: 400px) { .particle:nth-child(n+25) { display: none; } }

        @keyframes apparitionBouton { 0% { opacity: 0; transform: translateY(30px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes ripple { 0% { transform: scale(0, 0) translate(-50%, -50%); opacity: 0.5; } 100% { transform: scale(20, 20) translate(-50%, -50%); opacity: 0; } }
        @keyframes circleWave { 0% { opacity: 0.9; transform: scale(0.5); } 70% { opacity: 0.5; transform: scale(1.3); } 100% { opacity: 0; transform: scale(1.6); } }

        .home-btn { width: 320px; height: 65px; background: white; color: black; border: none; border-radius: 15px; font-size: 24px; font-weight: 600; letter-spacing: 1px; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2); transition: transform 0.2s, box-shadow 0.2s, background 0.2s; position: relative; overflow: hidden; margin: 12px 0; opacity: 0; transform: translateY(30px); animation: apparitionBouton 0.5s ease-out forwards; }
        #btn-perform { animation-delay: 0.2s; } #btn-list { animation-delay: 0.4s; } #btn-settings { animation-delay: 0.6s; }
        .home-btn::after { content: ''; position: absolute; top: 50%; left: 50%; width: 5px; height: 5px; background: rgba(0, 0, 0, 0.3); opacity: 0; border-radius: 100%; transform: scale(1, 1) translate(-50%, -50%); transform-origin: 50% 50%; }
        .home-btn:active { transform: scale(0.95); box-shadow: 0 2px 10px rgba(255, 255, 255, 0.4); background: #f0f0f0; }
        .home-btn:active::after { animation: ripple 0.4s ease-out; }

        #home-page { 
            position: absolute; 
            inset: 0; 
            background: black; 
            display: flex; 
            flex-direction: column; 
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 15vh;
            z-index: 20; 
            transition: transform 0.3s ease-out; 
        }
        #home-page.hidden { transform: translateY(-100%); }

        #settings-page { position: absolute; inset: 0; background: black; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 25; visibility: hidden; opacity: 0; transition: visibility 0.3s, opacity 0.3s; padding: 20px; }
        #settings-page.visible { visibility: visible; opacity: 1; }

        .settings-title { font-size: 48px; color: #FFD700; margin-bottom: 50px; font-weight: bold; text-transform: uppercase; letter-spacing: 4px; }
        .settings-btn { width: 320px; height: 65px; background: #333; color: white; border: none; border-radius: 15px; font-size: 22px; font-weight: 600; cursor: pointer; margin: 10px 0; transition: background 0.2s; }
        .settings-btn:active { background: #555; }

        .preview-container { width: 320px; margin: 20px 0; display: none; flex-direction: column; align-items: center; }
        .preview-container.visible { display: flex; }
        .preview-image { width: 200px; height: 200px; object-fit: cover; border-radius: 15px; border: 3px solid #FFD700; margin-bottom: 15px; }
        .preview-buttons { display: flex; gap: 20px; }
        .preview-confirm, .preview-cancel { width: 120px; height: 50px; border: none; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; }
        .preview-confirm { background: #4CAF50; color: white; }        .preview-cancel { background: #f44336; color: white; }
        .back-btn { width: 320px; height: 50px; background: #666; color: white; border: none; border-radius: 10px; font-size: 18px; cursor: pointer; margin-top: 30px; }
        .back-btn:active { background: #888; }

        #customize-page { position: absolute; inset: 0; background: rgba(0, 0, 0, 0.95); z-index: 40; visibility: hidden; opacity: 0; transition: visibility 0.3s, opacity 0.3s; overflow-y: auto; padding: 20px; color: white; }
        #customize-page.visible { visibility: visible; opacity: 1; }
        
        #customize-note-page { 
            position: absolute; 
            inset: 0; 
            background: rgba(0, 0, 0, 0.95); 
            z-index: 70; 
            visibility: hidden; 
            opacity: 0; 
            transition: visibility 0.3s, opacity 0.3s; 
            overflow-y: auto; 
            padding: 20px; 
            color: white;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
        }
        #customize-note-page.visible { visibility: visible; opacity: 1; }
        
        #customize-page.dragging-slider { background: transparent !important; pointer-events: none; }
        #customize-note-page.dragging-slider { pointer-events: none; }
        
        #customize-page.dragging-slider .control-group, #customize-page.dragging-slider .test-code-section, #customize-page.dragging-slider .customize-header, #customize-page.dragging-slider .customize-actions,
        #customize-note-page.dragging-slider .control-group, #customize-note-page.dragging-slider .customize-header, #customize-note-page.dragging-slider .customize-actions { opacity: 0 !important; pointer-events: none; }
        #customize-page.dragging-slider input[type="range"], #customize-note-page.dragging-slider input[type="range"] { opacity: 1 !important; position: relative; z-index: 9999; pointer-events: auto; }
        #customize-page.dragging-slider .value-badge, #customize-note-page.dragging-slider .value-badge { opacity: 1 !important; position: relative; z-index: 9999; pointer-events: auto; cursor: pointer; background: #FFD700; color: black; font-weight: bold; }
        #customize-page.dragging-slider .slider-item, #customize-note-page.dragging-slider .slider-item { position: relative; z-index: 9999; }
        #customize-page.dragging-slider .slider-item label, #customize-note-page.dragging-slider .slider-item label { opacity: 0 !important; }
        
        #result-page.preview-mode { visibility: visible !important; opacity: 1 !important; z-index: 35; pointer-events: none; }
        #customize-note-page.preview-mode { background: rgba(0, 0, 0, 0.85); }

        .customize-header { display: flex; align-items: center; margin-bottom: 30px; padding-top: 20px; }
        .customize-back-btn { width: 40px; height: 40px; background: #333; border: none; border-radius: 50%; color: white; font-size: 24px; cursor: pointer; margin-right: 15px; }
        .customize-back-btn:active { background: #555; }
        .customize-title { font-size: 32px; color: #FFD700; font-weight: bold; }

        .test-code-section { background: #222; border-radius: 15px; padding: 20px; margin-bottom: 25px; border: 1px solid #444; text-align: center; }
        .test-code-title { color: #FFD700; font-size: 22px; margin-bottom: 15px; }
        #test-code-input { width: 200px; height: 55px; background: #333; border: 2px solid #444; border-radius: 15px; color: white; font-size: 18px; text-align: center; letter-spacing: 4px; }
        #test-code-input:focus { border-color: #FFD700; outline: none; }

        .control-group { background: #222; border-radius: 15px; padding: 20px; margin-bottom: 25px; border: 1px solid #444; }
        .control-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .control-header h3 { color: #FFD700; font-size: 22px; margin: 0; }        .preview-btn { background: #333; color: white; border: 1px solid #FFD700; border-radius: 20px; padding: 5px 15px; font-size: 14px; cursor: pointer; }
        .slider-item { margin-bottom: 20px; }
        .slider-item label { display: flex; justify-content: space-between; margin-bottom: 8px; color: #ddd; }
        
        .slider-item input[type="range"] {
            width: 100%;
            height: 6px;
            background: #444;
            border-radius: 3px;
            -webkit-appearance: none;
            pointer-events: none;
        }
        
        .slider-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #FFD700;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            pointer-events: auto;
        }
        
        .slider-item input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #FFD700;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            pointer-events: auto;
        }
        
        .color-item { margin-bottom: 20px; }
        .color-item label { display: block; margin-bottom: 8px; color: #ddd; }
        .color-item input[type="color"] { width: 100%; height: 45px; border: 2px solid #444; border-radius: 10px; background: #333; }
        .value-badge { background: #333; padding: 3px 10px; border-radius: 15px; font-size: 14px; color: #FFD700; border: 1px solid #FFD700; cursor: pointer; }
        .value-badge:active { background: #444; }

        .customize-actions { display: flex; gap: 15px; margin-top: 30px; margin-bottom: 30px; }
        .customize-save { flex: 1.2; height: 55px; background: #4CAF50; border: none; border-radius: 15px; color: white; font-size: 20px; font-weight: 600; cursor: pointer; }
        .customize-reset { flex: 1; height: 55px; background: #f44336; border: none; border-radius: 15px; color: white; font-size: 18px; font-weight: 600; cursor: pointer; }

        #lock-page {
            position: absolute;
            inset: 0;
            z-index: 10;
            visibility: hidden;
            opacity: 0;            transition: visibility 0.3s, opacity 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: #1a1a1a;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
        }
        
        #result-page {
            position: absolute;
            inset: 0;
            z-index: 30;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
            background: #2a2a2a;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        #lock-page.visible { visibility: visible; opacity: 1; }
        #result-page.visible { visibility: visible; opacity: 1; }
        
        .overlay { position: absolute; inset: 0; background: rgba(0, 0, 0, 0.3); }
        .lock-content { position: relative; z-index: 10; text-align: center; margin-bottom: 5vh; padding: 0 16px; }
        .pin-dots { display: flex; justify-content: center; gap: 16px; margin-bottom: 3vh; }
        .dot { width: 14px; height: 14px; border-radius: 50%; background: white; opacity: 0.35; transition: opacity 0.2s, transform 0.2s; }
        .dot.active { opacity: 1; transform: scale(1.25); }
        .keypad { display: grid; grid-template-columns: repeat(3, 70px); justify-content: center; gap: 20px 25px; margin-bottom: 15px; }
        .key { width: 70px; height: 70px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(12px); cursor: pointer; border: 1px solid rgba(255,255,255,0.1); color: white; }
        .key-number { font-size: 28px; font-weight: 500; }
        .key-letters { font-size: 10px; color: rgba(255, 255, 255, 0.6); margin-top: 2px; }
        .key:active { background: rgba(255, 255, 255, 0.35); transform: scale(0.97); }
        .key::after { content: ''; position: absolute; inset: 0; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.9); opacity: 0; pointer-events: none; }
        .active::after, .active-text::after { animation: circleWave 0.4s ease-out forwards; }

        .bottom-row { display: grid; grid-template-columns: repeat(3, 70px); justify-content: center; gap: 25px; margin-top: 10px; }
        .delete-btn, .ok { width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; background: transparent; cursor: pointer; border: none; color: white; }
        .delete-btn { font-size: 34px; }
        .ok { font-size: 24px; font-weight: 600; }
        .delete-btn:active, .ok:active { opacity: 0.7; transform: scale(0.95); }

        .emergency { text-align: center; margin-bottom: 3vh; font-size: 18px; opacity: 0.9; cursor: pointer; padding: 12px 24px; border-radius: 40px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.15); width: fit-content; margin-left: auto; margin-right: auto; }        .emergency:active { background: rgba(220, 60, 60, 0.5); }

        .words-container { position: absolute; top: 265px; width: 100%; z-index: 32; color: white; font-size: 18px; text-align: center; }
        .words-container.hidden { display: none; }
        .words-line { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; padding: 0 20px; }
        .result-word { cursor: pointer; }
        .letters-container { position: absolute; top: 460px; width: 100%; text-align: center; color: white; font-size: 20px; z-index: 32; padding: 0 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 40px; }
        .letters-container.hidden { display: none; }
        .letter-btn { cursor: pointer; text-transform: uppercase; }
        .letter-btn.selected { text-decoration: underline; }
        
        .index-display {
            position: absolute;
            top: 517px;
            left: 50%;
            transform: translateX(calc(-50% - 45px));
            color: #1E6FF0;
            font-size: 30px;
            font-weight: bold;
            z-index: 33;
            cursor: pointer;
            transition: text-shadow 0.3s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        .index-display.note-mode-active {
            animation: auraPulse 1.5s ease-in-out infinite;
        }

        #note-page {
            position: absolute;
            inset: 0;
            z-index: 50;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #note-page.visible {
            visibility: visible;
            opacity: 1;        }
        
        .note-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 51;
        }
        
        /* ‚úÖ CORRECTION : Position X fixe (sans -50%) */
        .note-text {
            position: absolute;
            top: 262px;
            left: 50%;
            /* ‚úÖ SANS -50% : le bord gauche reste fixe */
            transform: translateX(0px);
            z-index: 52;
            color: white;
            font-size: 18px;
            font-weight: normal;
            text-align: left;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
            padding: 20px;
            max-width: 80%;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            text-indent: 0;
            line-height: 15px;
            cursor: text;
            outline: none;
        }

        #list-modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 380px; background: white; border-radius: 30px; padding: 25px; z-index: 100; display: none; color: black; box-shadow: 0 20px 40px rgba(0,0,0,0.4); transition: top 0.3s ease-out, transform 0.3s ease-out; }
        #list-modal.visible { display: block; }
        #list-modal.keyboard-open { top: 30px; transform: translate(-50%, 0); }
        #search-input { width: 100%; padding: 18px; border: 2px solid #ddd; border-radius: 15px; font-size: 18px; height: 60px; box-sizing: border-box; margin-bottom: 15px; }
        .code-result-box { width: 100%; padding: 18px; border: 2px solid #1976d2; border-radius: 15px; font-size: 20px; text-align: center; background: #e3f2fd; color: #1976d2; font-weight: bold; min-height: 60px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; }
        .code-result-box.error { background: #ffebee; border-color: #f44336; color: #f44336; }
        #search-btn { width: 100%; padding: 18px; background: #4CAF50; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 20px; font-weight: 600; }
        #search-btn.disabled { background: #999; opacity: 0.6; pointer-events: none; }
        #modal-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); z-index: 90; display: none; }
        #modal-overlay.visible { display: block; }
        .hidden-file-input { display: none; }
    </style>
</head>
<body>
    <input type="file" id="bg-file-input" class="hidden-file-input" accept="image/*">
    <input type="file" id="img-file-input" class="hidden-file-input" accept="image/*">    <input type="file" id="note-file-input" class="hidden-file-input" accept="image/*">
    <div id="home-page">
        <div class="app-title-wrapper">
            <div class="app-title">
                <span class="letter" style="--i: 0">E</span>
                <span class="letter" style="--i: 1">N</span>
                <span class="letter" style="--i: 2">I</span>
                <span class="letter" style="--i: 3">G</span>
                <span class="letter" style="--i: 4">M</span>
                <span class="letter" style="--i: 5">A</span>
            </div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div><div class="particle"></div>
        </div>
        
        <button class="home-btn" id="btn-perform">PERFORMER</button>
        <button class="home-btn" id="btn-list">LISTE DES MOTS</button>
        <button class="home-btn" id="btn-settings">PARAMETRES</button>
    </div>

    <div id="settings-page">
        <div class="settings-title">PARAM√àTRES</div>
        <button class="settings-btn" id="import-bg-btn">üì∑ Importer lock screen</button>
        <button class="settings-btn" id="import-img-btn">üì∑ Importer background</button>
        <button class="settings-btn" id="import-note-btn">üì∑ Importer note</button>
        <button class="settings-btn" id="customize-btn">üé® Modifier background</button>
        <button class="settings-btn" id="modify-note-btn">üé® Modifier note</button>
        <div class="preview-container" id="preview-container">
            <img class="preview-image" id="preview-image" src="" alt="Aper√ßu">
            <div class="preview-buttons">
                <button class="preview-confirm" id="preview-confirm">Confirmer</button>
                <button class="preview-cancel" id="preview-cancel">Annuler</button>
            </div>
        </div>
        <button class="back-btn" id="settings-back">‚Üê Retour</button>
    </div>

    <div id="customize-page">        <div class="customize-header">
            <button class="customize-back-btn" id="customize-back">‚Üê</button>
            <span class="customize-title">PERSONNALISER</span>
        </div>
        <div class="test-code-section">
            <div class="test-code-title">üéØ TESTER UN CODE</div>
            <input type="tel" id="test-code-input" placeholder="Code" maxlength="4">
        </div>
        <div class="control-group">
            <div class="control-header">
                <h3>üìã Liste</h3>
                <button class="preview-btn" id="preview-list-btn">üëÅÔ∏è</button>
            </div>
            <div class="slider-item">
                <label>Position Y <span class="value-badge" id="words-y-value">265px</span></label>
                <input type="range" id="words-y" min="0" max="800" value="265">
            </div>
            <div class="slider-item">
                <label>Taille <span class="value-badge" id="words-size-value">18px</span></label>
                <input type="range" id="words-size" min="10" max="40" value="18">
            </div>
            <div class="color-item">
                <label>Couleur</label>
                <input type="color" id="words-color" value="#ffffff">
            </div>
            <div class="slider-item">
                <label>Espace lignes <span class="value-badge" id="words-line-height-value">15px</span></label>
                <input type="range" id="words-line-height" min="5" max="30" value="15">
            </div>
        </div>
        <div class="control-group">
            <div class="control-header">
                <h3>üî§ Lettres</h3>
                <button class="preview-btn" id="preview-letters-btn">üëÅÔ∏è</button>
            </div>
            <div class="slider-item">
                <label>Position Y <span class="value-badge" id="letters-y-value">460px</span></label>
                <input type="range" id="letters-y" min="0" max="800" value="460">
            </div>
            <div class="slider-item">
                <label>Taille <span class="value-badge" id="letters-size-value">20px</span></label>
                <input type="range" id="letters-size" min="10" max="40" value="20">
            </div>
            <div class="color-item">
                <label>Couleur</label>
                <input type="color" id="letters-color" value="#ffffff">
            </div>
            <div class="slider-item">
                <label>Espace lettres <span class="value-badge" id="letters-spacing-value">40px</span></label>
                <input type="range" id="letters-spacing" min="0" max="100" value="40">            </div>
        </div>
        <div class="control-group">
            <div class="control-header">
                <h3>üî¢ Indice</h3>
                <button class="preview-btn" id="preview-index-btn">üëÅÔ∏è</button>
            </div>
            <div class="slider-item">
                <label>Position Y <span class="value-badge" id="index-y-value">517px</span></label>
                <input type="range" id="index-y" min="0" max="800" value="517">
            </div>
            <div class="slider-item">
                <label>Taille <span class="value-badge" id="index-size-value">30px</span></label>
                <input type="range" id="index-size" min="10" max="60" value="30">
            </div>
            <div class="color-item">
                <label>Couleur</label>
                <input type="color" id="index-color" value="#1E6FF0">
            </div>
            <div class="slider-item">
                <label>D√©calage X <span class="value-badge" id="index-x-value">-45px</span></label>
                <input type="range" id="index-x" min="-500" max="500" value="-45">
            </div>
        </div>
        <div class="customize-actions">
            <button class="customize-save" id="customize-save">üíæ Sauvegarder</button>
            <button class="customize-reset" id="customize-reset">‚Ü∫ Reinitialiser</button>
        </div>
    </div>

    <div id="customize-note-page">
        <div class="customize-header">
            <button class="customize-back-btn" id="customize-note-back">‚Üê</button>
            <span class="customize-title">PERSONNALISER</span>
        </div>
        
        <div class="note-words-container" id="note-words-container" style="position: absolute; top: 262px; left: 50%; transform: translateX(0px); z-index: 55; color: white; font-size: 18px; text-align: left; line-height: 15px; padding: 20px; max-width: 80%; font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;">
            <div class="note-word-item">Barbecue</div>
            <div class="note-word-item">Iceberg</div>
            <div class="note-word-item">Cartouche</div>
            <div class="note-word-item">Yaourt</div>
            <div class="note-word-item">Cartable</div>
            <div class="note-word-item">Livre</div>
            <div class="note-word-item">Enveloppe</div>
            <div class="note-word-item">Tapis</div>
            <div class="note-word-item">Train</div>
            <div class="note-word-item">Encre</div>
        </div>
        <div class="control-group" style="position: relative; z-index: 60;">
            <div class="control-header">                <h3>üìù Note</h3>
                <button class="preview-btn" id="preview-note-btn">üëÅÔ∏è</button>
            </div>
            
            <div class="slider-item">
                <label>Position X <span class="value-badge" id="note-x-value">0px</span></label>
                <input type="range" id="note-x" min="-500" max="500" value="0">
            </div>
            
            <div class="slider-item">
                <label>Position Y <span class="value-badge" id="note-y-value">262px</span></label>
                <input type="range" id="note-y" min="0" max="800" value="262">
            </div>
            
            <div class="slider-item">
                <label>Taille <span class="value-badge" id="note-size-value">18px</span></label>
                <input type="range" id="note-size" min="10" max="40" value="18">
            </div>
            
            <div class="color-item">
                <label>Couleur</label>
                <input type="color" id="note-color" value="#ffffff">
            </div>
            
            <div class="slider-item">
                <label>Espace lignes <span class="value-badge" id="note-line-height-value">15px</span></label>
                <input type="range" id="note-line-height" min="5" max="30" value="15">
            </div>
        </div>
        
        <div class="customize-actions" style="position: relative; z-index: 60;">
            <button class="customize-save" id="customize-note-save">üíæ Sauvegarder</button>
            <button class="customize-reset" id="customize-note-reset">‚Ü∫ Reinitialiser</button>
        </div>
    </div>

    <div id="lock-page">
        <div class="overlay"></div>
        <div class="lock-content">
            <div class="pin-dots">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
            </div>
            <div class="keypad">
                <div class="key"><span class="key-number">1</span></div>
                <div class="key"><span class="key-number">2</span><span class="key-letters">ABC</span></div>
                <div class="key"><span class="key-number">3</span><span class="key-letters">DEF</span></div>
                <div class="key"><span class="key-number">4</span><span class="key-letters">GHI</span></div>
                <div class="key"><span class="key-number">5</span><span class="key-letters">JKL</span></div>
                <div class="key"><span class="key-number">6</span><span class="key-letters">MNO</span></div>
                <div class="key"><span class="key-number">7</span><span class="key-letters">PQRS</span></div>                <div class="key"><span class="key-number">8</span><span class="key-letters">TUV</span></div>
                <div class="key"><span class="key-number">9</span><span class="key-letters">WXYZ</span></div>
            </div>
            <div class="bottom-row">
                <div class="delete-btn" id="deleteBtn">‚å´</div>
                <div class="key"><span class="key-number">0</span></div>
                <div class="ok" id="okBtn">OK</div>
            </div>
        </div>
        <div class="emergency" id="emergencyBtn">üìû Appel d'urgence</div>
    </div>

    <div id="result-page">
        <div class="words-container" id="words-container"></div>
        <div class="letters-container" id="letters-container"></div>
        <div class="index-display" id="index-display"></div>
    </div>

    <div id="note-page">
        <div class="note-overlay"></div>
        <div class="note-text" id="note-text" contenteditable="true"></div>
    </div>

    <div id="modal-overlay"></div>
    <div id="list-modal">
        <input type="text" id="search-input" placeholder="Taper un mot">
        <div class="code-result-box" id="codeResult"></div>
        <button id="search-btn">Rechercher</button>
    </div>

    <script>
(function() {
    const homePage = document.getElementById('home-page');
    const settingsPage = document.getElementById('settings-page');
    const customizePage = document.getElementById('customize-page');
    const customizeNotePage = document.getElementById('customize-note-page');
    const lockPage = document.getElementById('lock-page');
    const resultPage = document.getElementById('result-page');
    const notePage = document.getElementById('note-page');
    const noteText = document.getElementById('note-text');
    const noteWordsContainer = document.getElementById('note-words-container');
    const wordsContainer = document.getElementById('words-container');
    const lettersContainer = document.getElementById('letters-container');
    const indexDisplay = document.getElementById('index-display');
    const btnPerform = document.getElementById('btn-perform');
    const btnList = document.getElementById('btn-list');
    const btnSettings = document.getElementById('btn-settings');
    const importBgBtn = document.getElementById('import-bg-btn');
    const importImgBtn = document.getElementById('import-img-btn');
    const importNoteBtn = document.getElementById('import-note-btn');    const modifyNoteBtn = document.getElementById('modify-note-btn');
    const customizeBtn = document.getElementById('customize-btn');
    const settingsBack = document.getElementById('settings-back');
    const customizeBack = document.getElementById('customize-back');
    const customizeNoteBack = document.getElementById('customize-note-back');
    const customizeSave = document.getElementById('customize-save');
    const customizeReset = document.getElementById('customize-reset');
    const customizeNoteSave = document.getElementById('customize-note-save');
    const customizeNoteReset = document.getElementById('customize-note-reset');
    const previewListBtn = document.getElementById('preview-list-btn');
    const previewLettersBtn = document.getElementById('preview-letters-btn');
    const previewIndexBtn = document.getElementById('preview-index-btn');
    const previewNoteBtn = document.getElementById('preview-note-btn');
    const testCodeInput = document.getElementById('test-code-input');
    const wordsY = document.getElementById('words-y');
    const wordsSize = document.getElementById('words-size');
    const wordsColor = document.getElementById('words-color');
    const wordsLineHeight = document.getElementById('words-line-height');
    const lettersY = document.getElementById('letters-y');
    const lettersSize = document.getElementById('letters-size');
    const lettersColor = document.getElementById('letters-color');
    const lettersSpacing = document.getElementById('letters-spacing');
    const indexY = document.getElementById('index-y');
    const indexSize = document.getElementById('index-size');
    const indexColor = document.getElementById('index-color');
    const indexX = document.getElementById('index-x');
    const noteX = document.getElementById('note-x');
    const noteY = document.getElementById('note-y');
    const noteSize = document.getElementById('note-size');
    const noteColor = document.getElementById('note-color');
    const noteLineHeight = document.getElementById('note-line-height');
    const wordsYValue = document.getElementById('words-y-value');
    const wordsSizeValue = document.getElementById('words-size-value');
    const wordsLineHeightValue = document.getElementById('words-line-height-value');
    const lettersYValue = document.getElementById('letters-y-value');
    const lettersSizeValue = document.getElementById('letters-size-value');
    const lettersSpacingValue = document.getElementById('letters-spacing-value');
    const indexYValue = document.getElementById('index-y-value');
    const indexSizeValue = document.getElementById('index-size-value');
    const indexXValue = document.getElementById('index-x-value');
    const noteXValue = document.getElementById('note-x-value');
    const noteYValue = document.getElementById('note-y-value');
    const noteSizeValue = document.getElementById('note-size-value');
    const noteLineHeightValue = document.getElementById('note-line-height-value');
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');
    const codeResult = document.getElementById('codeResult');
    const modal = document.getElementById('list-modal');
    const modalOverlay = document.getElementById('modal-overlay');
    const bgFileInput = document.getElementById('bg-file-input');    const imgFileInput = document.getElementById('img-file-input');
    const noteFileInput = document.getElementById('note-file-input');
    const previewContainer = document.getElementById('preview-container');
    const previewImage = document.getElementById('preview-image');
    const previewConfirm = document.getElementById('preview-confirm');
    const previewCancel = document.getElementById('preview-cancel');
    const keys = document.querySelectorAll('#lock-page .key');
    const dots = document.querySelectorAll('#lock-page .dot');
    const deleteBtn = document.getElementById('deleteBtn');
    const okBtn = document.getElementById('okBtn');
    const emergencyBtn = document.getElementById('emergencyBtn');

    const wordsList = [
    { code: "7131", word: "Abeille" },
    { code: "7141", word: "Abricot" },
    { code: "9141", word: "Accordeon" },
    { code: "6131", word: "Agenda" },
    { code: "6141", word: "Agneau" },
    { code: "9141", word: "Agrafeuse" },
    { code: "5121", word: "Aigle" },
    { code: "8121", word: "Aiguille" },
    { code: "3121", word: "Ail" },
    { code: "4121", word: "Aile" },
    { code: "6121", word: "Aimant" },
    { code: "9141", word: "Allumette" },
    { code: "9141", word: "Ambulance" },
    { code: "5151", word: "Ampli" },
    { code: "7141", word: "Ampoule" },
    { code: "6131", word: "Ananas" },
    { code: "8131", word: "Anatomie" },
    { code: "5151", word: "Ancre" },
    { code: "3131", word: "Ane" },
    { code: "4141", word: "Ange" },
    { code: "8141", word: "Anguille" },
    { code: "7141", word: "Anneaux" },
    { code: "4141", word: "Anse" },
    { code: "7141", word: "Antenne" },
    { code: "8141", word: "Appareil" },
    { code: "8131", word: "Araignee" },
    { code: "5151", word: "Arbre" },
    { code: "3101", word: "Arc" },
    { code: "5151", word: "Arche" },
    { code: "6151", word: "Archet" },
    { code: "6141", word: "Argent" },
    { code: "7141", word: "Armoire" },
    { code: "8141", word: "Arrosoir" },
    { code: "9141", word: "Artichaut" },
    { code: "7141", word: "Asperge" },
    { code: "0141", word: "Aspirateur" },
    { code: "8141", word: "Assiette" },
    { code: "0151", word: "Astronaute" },
    { code: "7121", word: "Autobus" },
    { code: "8121", word: "Autruche" },
    { code: "6121", word: "Auvent" },
    { code: "5131", word: "Avion" },
    { code: "6131", word: "Avocat" },
    { code: "5242", word: "Bague" },
    { code: "8242", word: "Baguette" },
    { code: "9232", word: "Baignoire" },
    { code: "3202", word: "Bal" },
    { code: "5242", word: "Balai" },
    { code: "7242", word: "Balance" },    { code: "0242", word: "Balancoire" },
    { code: "6252", word: "Balcon" },
    { code: "7242", word: "Baleine" },
    { code: "5252", word: "Balle" },
    { code: "6252", word: "Ballon" },
    { code: "0242", word: "Dirigeable" },
    { code: "6242", word: "Banane" },
    { code: "4202", word: "Banc" },
    { code: "5252", word: "Banjo" },
    { code: "5252", word: "Barbe" },
    { code: "8252", word: "Barbecue" },
    { code: "7252", word: "Barbele" },
    { code: "8252", word: "Barbiche" },
    { code: "5242", word: "Baril" },
    { code: "6252", word: "Barque" },
    { code: "5252", word: "Barre" },
    { code: "7252", word: "Barreau" },
    { code: "7252", word: "Bascule" },
    { code: "7252", word: "Bassine" },
    { code: "6242", word: "Bateau" },
    { code: "8252", word: "Batterie" },
    { code: "3202", word: "Bec" },
    { code: "7252", word: "Berceau" },
    { code: "6232", word: "Beurre" },
    { code: "7242", word: "Biberon" },
    { code: "1252", word: "Bibliotheque" },
    { code: "5252", word: "Biche" },
    { code: "5252", word: "Bille" },
    { code: "6252", word: "Billet" },
    { code: "7242", word: "Binette" },
    { code: "8252", word: "Biscotte" },
    { code: "7252", word: "Biscuit" },
    { code: "5242", word: "Bison" },
    { code: "6362", word: "Blatte" },
    { code: "3302", word: "Ble" },
    { code: "6242", word: "Bobine" },
    { code: "5242", word: "Bocal" },
    { code: "5232", word: "Boite" },
    { code: "3202", word: "Bol" },
    { code: "5252", word: "Bombe" },
    { code: "6252", word: "Bonbon" },
    { code: "6252", word: "Bonnet" },
    { code: "9232", word: "Boomerang" },
    { code: "5252", word: "Borne" },
    { code: "5252", word: "Bosse" },
    { code: "5252", word: "Botte" },
    { code: "4232", word: "Bouc" },
    { code: "6232", word: "Bouche" },
    { code: "7232", word: "Bouchon" },
    { code: "6232", word: "Boucle" },    { code: "8232", word: "Bouclier" },
    { code: "6232", word: "Bougie" },
    { code: "0232", word: "Bouilloire" },
    { code: "5232", word: "Boule" },
    { code: "6232", word: "Boulet" },
    { code: "8232", word: "Bourreau" },
    { code: "8232", word: "Boussole" },
    { code: "9232", word: "Bouteille" },
    { code: "6232", word: "Bouton" },
    { code: "5232", word: "Bouee" },
    { code: "7372", word: "Branche" },
    { code: "4302", word: "Bras" },
    { code: "6352", word: "Brique" },
    { code: "7352", word: "Briquet" },
    { code: "6362", word: "Broche" },
    { code: "7352", word: "Brocoli" },
    { code: "6362", word: "Brosse" },
    { code: "8342", word: "Brouette" },
    { code: "6262", word: "Buffle" },
    { code: "5252", word: "Bulle" },
    { code: "6242", word: "Bureau" },
    { code: "5242", word: "Burin" },
    { code: "3202", word: "Bus" },
    { code: "4242", word: "Bebe" },
    { code: "9242", word: "Bequilles" },
    { code: "5242", word: "Beret" },
    { code: "5252", word: "Beche" },
    { code: "6252", word: "Buches" },
    { code: "6243", word: "Cabine" },
    { code: "9243", word: "Cacahuete" },
    { code: "8253", word: "Cachalot" },
    { code: "6253", word: "Cactus" },
    { code: "6253", word: "Caddie" },
    { code: "6243", word: "Cadeau" },
    { code: "7243", word: "Cadenas" },
    { code: "6253", word: "Cadran" },
    { code: "5253", word: "Cadre" },
    { code: "9243", word: "Cafetiere" },
    { code: "4243", word: "Cage" },
    { code: "6243", word: "Cahier" },
    { code: "6233", word: "Caisse" },
    { code: "1253", word: "Calculatrice" },
    { code: "0243", word: "Calendrier" },
    { code: "6253", word: "Calmar" },
    { code: "7243", word: "Calumet" },
    { code: "6243", word: "Camion" },
    { code: "7253", word: "Camping" },
    { code: "6243", word: "Camera" },
    { code: "6243", word: "Canape" },
    { code: "6243", word: "Canard" },    { code: "4243", word: "Cane" },
    { code: "5243", word: "Canif" },
    { code: "5253", word: "Canne" },
    { code: "5243", word: "Canon" },
    { code: "5243", word: "Canoe" },
    { code: "4243", word: "Cape" },
    { code: "5243", word: "Capot" },
    { code: "7253", word: "Capsule" },
    { code: "7243", word: "Capuche" },
    { code: "8243", word: "Carabine" },
    { code: "6243", word: "Carafe" },
    { code: "8243", word: "Caravane" },
    { code: "5253", word: "Cargo" },
    { code: "8243", word: "Carillon" },
    { code: "6253", word: "Carnet" },
    { code: "7243", word: "Carotte" },
    { code: "8253", word: "Carpette" },
    { code: "8253", word: "Carquois" },
    { code: "8253", word: "Carrosse" },
    { code: "8253", word: "Cartable" },
    { code: "5253", word: "Carte" },
    { code: "6253", word: "Carton" },
    { code: "9253", word: "Cartouche" },
    { code: "6243", word: "Casier" },
    { code: "6253", word: "Casque" },
    { code: "9253", word: "Casquette" },
    { code: "9253", word: "Casserole" },
    { code: "8253", word: "Cassette" },
    { code: "6253", word: "Castor" },
    { code: "9243", word: "Catapulte" },
    { code: "8233", word: "Ceinture" },
    { code: "8263", word: "Cendrier" },
    { code: "4203", word: "Cent" },
    { code: "8253", word: "Centaure" },
    { code: "7253", word: "Cerceau" },
    { code: "6263", word: "Cercle" },
    { code: "8253", word: "Cercueil" },
    { code: "4203", word: "Cerf" },
    { code: "6243", word: "Cerise" },
    { code: "7253", word: "Cerveau" },
    { code: "6343", word: "Chaise" },
    { code: "7353", word: "Chameau" },
    { code: "5303", word: "Champ" },
    { code: "0363", word: "Champignon" },
    { code: "0363", word: "Chandelier" },
    { code: "7353", word: "Chapeau" },
    { code: "9353", word: "Chapiteau" },
    { code: "9363", word: "Charrette" },
    { code: "7363", word: "Charrue" },
    { code: "4303", word: "Chat" },    { code: "0343", word: "Chaussette" },
    { code: "8343", word: "Chausson" },
    { code: "9343", word: "Chaussure" },
    { code: "6343", word: "Chaine" },
    { code: "8353", word: "Cheminee" },
    { code: "7353", word: "Chemise" },
    { code: "9353", word: "Chemisier" },
    { code: "8353", word: "Chenille" },
    { code: "6353", word: "Cheval" },
    { code: "8353", word: "Chevalet" },
    { code: "7353", word: "Cheveux" },
    { code: "0353", word: "Chewinggum" },
    { code: "5343", word: "Chien" },
    { code: "7363", word: "Chignon" },
    { code: "5353", word: "Chope" },
    { code: "4343", word: "Chou" },
    { code: "1463", word: "Chronometre" },
    { code: "5353", word: "Chale" },
    { code: "9353", word: "Chataigne" },
    { code: "7353", word: "Chateau" },
    { code: "6363", word: "Chevre" },
    { code: "5353", word: "Chene" },
    { code: "5403", word: "Choeur" },
    { code: "5253", word: "Cible" },
    { code: "9243", word: "Cicatrice" },
    { code: "6243", word: "Cigale" },
    { code: "6243", word: "Cigare" },
    { code: "9243", word: "Cigarette" },
    { code: "7243", word: "Cigogne" },
    { code: "9243", word: "Cimetiere" },
    { code: "6263", word: "Cintre" },
    { code: "7253", word: "Circuit" },
    { code: "6253", word: "Cirque" },
    { code: "6243", word: "Ciseau" },
    { code: "7243", word: "Citerne" },
    { code: "6253", word: "Citron" },
    { code: "0253", word: "Citrouille" },
    { code: "7243", word: "Civiere" },
    { code: "8363", word: "Classeur" },
    { code: "7353", word: "Clavier" },
    { code: "4303", word: "Clef" },
    { code: "6363", word: "Cloche" },
    { code: "4343", word: "Clou" },
    { code: "5303", word: "Clown" },
    { code: "0253", word: "Coccinelle" },
    { code: "6253", word: "Cochon" },
    { code: "7243", word: "Cocotte" },
    { code: "6263", word: "Coffre" },
    { code: "5233", word: "Coing" },
    { code: "3203", word: "Col" },    { code: "8253", word: "Collants" },
    { code: "5253", word: "Colle" },
    { code: "7253", word: "Collier" },
    { code: "7243", word: "Colombe" },
    { code: "7243", word: "Colonne" },
    { code: "7253", word: "Commode" },
    { code: "6253", word: "Compas" },
    { code: "9253", word: "Concombre" },
    { code: "3203", word: "Coq" },
    { code: "5243", word: "Coque" },
    { code: "0243", word: "Coquillage" },
    { code: "3203", word: "Cor" },
    { code: "5253", word: "Corde" },
    { code: "5253", word: "Corne" },
    { code: "9253", word: "Cornemuse" },
    { code: "6253", word: "Cornet" },
    { code: "5203", word: "Corps" },
    { code: "3233", word: "Cou" },
    { code: "7233", word: "Couffin" },
    { code: "5233", word: "Coupe" },
    { code: "8233", word: "Couronne" },
    { code: "7233", word: "Couteau" },
    { code: "5353", word: "Crabe" },
    { code: "5343", word: "Craie" },
    { code: "7353", word: "Cravate" },
    { code: "6343", word: "Crayon" },
    { code: "8353", word: "Crevette" },
    { code: "7363", word: "Crochet" },
    { code: "9353", word: "Crocodile" },
    { code: "9343", word: "Croissant" },
    { code: "5343", word: "Croix" },
    { code: "6363", word: "Cruche" },
    { code: "5353", word: "Crane" },
    { code: "6363", word: "Creche" },
    { code: "5353", word: "Crepe" },
    { code: "5353", word: "Crete" },
    { code: "4243", word: "Cube" },
    { code: "8233", word: "Cuillere" },
    { code: "7233", word: "Cuisine" },
    { code: "0233", word: "Cuisiniere" },
    { code: "8253", word: "Cycliste" },
    { code: "5253", word: "Cygne" },
    { code: "8253", word: "Cymbales" },
    { code: "6243", word: "Celeri" },
    { code: "4303", word: "Coeur" },
    { code: "8252", word: "Danseuse" },
    { code: "7232", word: "Dauphin" },
    { code: "4202", word: "Dent" },
    { code: "6232", word: "Diable" },
    { code: "7232", word: "Diamant" },    { code: "0252", word: "Dictaphone" },
    { code: "9242", word: "Diligence" },
    { code: "6252", word: "Dindon" },
    { code: "9242", word: "Dinosaure" },
    { code: "6252", word: "Disque" },
    { code: "5232", word: "Diese" },
    { code: "5232", word: "Doigt" },
    { code: "6242", word: "Domino" },
    { code: "6232", word: "Douche" },
    { code: "6352", word: "Dragon" },
    { code: "4302", word: "Drap" },
    { code: "7352", word: "Drapeau" },
    { code: "6342", word: "Druide" },
    { code: "2202", word: "De" },
    { code: "0242", word: "Decoration" },
    { code: "9151", word: "Empreinte" },
    { code: "7151", word: "Enclume" },
    { code: "5151", word: "Encre" },
    { code: "7151", word: "Encrier" },
    { code: "6141", word: "Enfant" },
    { code: "9141", word: "Entonnoir" },
    { code: "9141", word: "Enveloppe" },
    { code: "8141", word: "Escabeau" },
    { code: "8141", word: "Escalier" },
    { code: "8141", word: "Escargot" },
    { code: "7141", word: "Espadon" },
    { code: "8141", word: "Esquimau" },
    { code: "0141", word: "Extincteur" },
    { code: "5241", word: "Fakir" },
    { code: "7241", word: "Famille" },
    { code: "4231", word: "Faon" },
    { code: "8231", word: "Fauteuil" },
    { code: "5251", word: "Femme" },
    { code: "7241", word: "Fenetre" },
    { code: "3201", word: "Fer" },
    { code: "9251", word: "Fermeture" },
    { code: "3231", word: "Feu" },
    { code: "7231", word: "Feuille" },
    { code: "5241", word: "Filet" },
    { code: "5251", word: "Fille" },
    { code: "4201", word: "Film" },
    { code: "6261", word: "Filtre" },
    { code: "5231", word: "Fiole" },
    { code: "6351", word: "Flacon" },
    { code: "7351", word: "Flamand" },
    { code: "8361", word: "Flambeau" },
    { code: "4301", word: "Flan" },
    { code: "5341", word: "Fleur" },
    { code: "7361", word: "Flipper" },
    { code: "6351", word: "Flocon" },    { code: "6361", word: "Fleche" },
    { code: "9361", word: "Flechette" },
    { code: "5351", word: "Flute" },
    { code: "5231", word: "Fouet" },
    { code: "7231", word: "Fougere" },
    { code: "4231", word: "Four" },
    { code: "7231", word: "Fourche" },
    { code: "0231", word: "Fourchette" },
    { code: "6231", word: "Fourmi" },
    { code: "0231", word: "Fourmilier" },
    { code: "6341", word: "Fraise" },
    { code: "0351", word: "Frigidaire" },
    { code: "6351", word: "Frites" },
    { code: "7351", word: "Fromage" },
    { code: "5241", word: "Fusil" },
    { code: "5241", word: "Fusee" },
    { code: "3231", word: "Fee" },
    { code: "4202", word: "Gant" },
    { code: "6242", word: "Garage" },
    { code: "6252", word: "Garcon" },
    { code: "6232", word: "Geisha" },
    { code: "8252", word: "Gendarme" },
    { code: "5242", word: "Gilet" },
    { code: "6242", word: "Girafe" },
    { code: "9242", word: "Girouette" },
    { code: "5352", word: "Glace" },
    { code: "5302", word: "Gland" },
    { code: "5352", word: "Globe" },
    { code: "5252", word: "Gomme" },
    { code: "7242", word: "Gorille" },
    { code: "6232", word: "Gourde" },
    { code: "6232", word: "Goutte" },
    { code: "6362", word: "Grange" },
    { code: "9362", word: "Graphique" },
    { code: "7352", word: "Grenade" },
    { code: "0352", word: "Grenouille" },
    { code: "6362", word: "Griffe" },
    { code: "6362", word: "Grille" },
    { code: "6362", word: "Grotte" },
    { code: "6342", word: "Groupe" },
    { code: "4342", word: "Grue" },
    { code: "7232", word: "Guitare" },
    { code: "8252", word: "Gymnaste" },
    { code: "6242", word: "Gateau" },
    { code: "5232", word: "Geant" },
    { code: "5251", word: "Hache" },
    { code: "7251", word: "Hachoir" },
    { code: "4231", word: "Haie" },
    { code: "7251", word: "Haltere" },
    { code: "5241", word: "Hamac" },    { code: "9251", word: "Hamburger" },
    { code: "7241", word: "Hamecon" },
    { code: "7241", word: "Haricot" },
    { code: "9251", word: "Harmonica" },
    { code: "5251", word: "Harpe" },
    { code: "6251", word: "Harpon" },
    { code: "5241", word: "Hibou" },
    { code: "0251", word: "Hippocampe" },
    { code: "1251", word: "Hippopotame" },
    { code: "1231", word: "Hieroglyphe" },
    { code: "6251", word: "Hochet" },
    { code: "6241", word: "Homard" },
    { code: "7251", word: "Horloge" },
    { code: "5251", word: "Hotte" },
    { code: "4231", word: "Houx" },
    { code: "6251", word: "Hublot" },
    { code: "6231", word: "Huitre" },
    { code: "5231", word: "Hyene" },
    { code: "6241", word: "Helice" },
    { code: "1241", word: "Helicoptere" },
    { code: "8241", word: "Herisson" },
    { code: "7131", word: "Iceberg" },
    { code: "5141", word: "Igloo" },
    { code: "3131", word: "Ile" },
    { code: "6141", word: "Indien" },
    { code: "0141", word: "Infirmiere" },
    { code: "1141", word: "Interrupteur" },
    { code: "5252", word: "Jambe" },
    { code: "6252", word: "Jambon" },
    { code: "4232", word: "Jeep" },
    { code: "7232", word: "Journal" },
    { code: "8242", word: "Jumelles" },
    { code: "4242", word: "Jupe" },
    { code: "9251", word: "Kangourou" },
    { code: "7231", word: "Kiosque" },
    { code: "4241", word: "Kiwi" },
    { code: "6351", word: "Klaxon" },
    { code: "5231", word: "Koala" },
    { code: "4241", word: "Kepi" },
    { code: "0241", word: "Labyrinthe" },
    { code: "3201", word: "Lac" },
    { code: "5241", word: "Lacet" },
    { code: "4231", word: "Laie" },
    { code: "6231", word: "Laisse" },
    { code: "4231", word: "Lait" },
    { code: "4241", word: "Lama" },
    { code: "4241", word: "Lame" },
    { code: "0251", word: "Lampadaire" },
    { code: "5251", word: "Lampe" },
    { code: "5251", word: "Lance" },    { code: "6251", word: "Landau" },
    { code: "6251", word: "Langue" },
    { code: "5241", word: "Lapin" },
    { code: "5241", word: "Laque" },
    { code: "5251", word: "Larme" },
    { code: "5251", word: "Lasso" },
    { code: "6241", word: "Lavabo" },
    { code: "6261", word: "Lettre" },
    { code: "9241", word: "Libellule" },
    { code: "7241", word: "Licorne" },
    { code: "6241", word: "Limace" },
    { code: "4241", word: "Lime" },
    { code: "4231", word: "Lion" },
    { code: "8231", word: "Lionceau" },
    { code: "3201", word: "Lit" },
    { code: "5251", word: "Livre" },
    { code: "0241", word: "Locomotive" },
    { code: "6231", word: "Louche" },
    { code: "4231", word: "Loup" },
    { code: "5231", word: "Loupe" },
    { code: "4241", word: "Luge" },
    { code: "4241", word: "Lune" },
    { code: "8241", word: "Lunettes" },
    { code: "4201", word: "Luth" },
    { code: "5251", word: "Lutte" },
    { code: "4201", word: "Lynx" },
    { code: "6251", word: "Levres" },
    { code: "7231", word: "Leopard" },
    { code: "6241", word: "Lezard" },
    { code: "7251", word: "Machine" },
    { code: "8241", word: "Magicien" },
    { code: "1251", word: "Magnetophone" },
    { code: "7231", word: "Maillot" },
    { code: "4231", word: "Main" },
    { code: "6231", word: "Maison" },
    { code: "5251", word: "Malle" },
    { code: "7251", word: "Manteau" },
    { code: "0251", word: "Mappemonde" },
    { code: "7241", word: "Maracas" },
    { code: "9251", word: "Marcassin" },
    { code: "7241", word: "Marelle" },
    { code: "0251", word: "Marguerite" },
    { code: "5241", word: "Marin" },
    { code: "1241", word: "Marionnette" },
    { code: "7251", word: "Marmite" },
    { code: "6251", word: "Marron" },
    { code: "7251", word: "Marteau" },
    { code: "6251", word: "Masque" },
    { code: "6251", word: "Massue" },
    { code: "4231", word: "Mais" },    { code: "6251", word: "Menhir" },
    { code: "8241", word: "Menottes" },
    { code: "3201", word: "Mer" },
    { code: "5251", word: "Micro" },
    { code: "0251", word: "Microscope" },
    { code: "6241", word: "Miroir" },
    { code: "4241", word: "Mite" },
    { code: "1251", word: "Mitraillette" },
    { code: "5241", word: "Momie" },
    { code: "5251", word: "Monde" },
    { code: "8251", word: "Montagne" },
    { code: "1261", word: "Montgolfiere" },
    { code: "6261", word: "Montre" },
    { code: "5251", word: "Morse" },
    { code: "6241", word: "Motard" },
    { code: "4241", word: "Moto" },
    { code: "6231", word: "Mouche" },
    { code: "6231", word: "Moufle" },
    { code: "5231", word: "Moule" },
    { code: "6231", word: "Moulin" },
    { code: "9231", word: "Moustache" },
    { code: "9231", word: "Moustique" },
    { code: "6231", word: "Mouton" },
    { code: "3201", word: "Mur" },
    { code: "5251", word: "Meche" },
    { code: "5251", word: "Metre" },
    { code: "8241", word: "Medaille" },
    { code: "0241", word: "Medicament" },
    { code: "6241", word: "Meduse" },
    { code: "5241", word: "Megot" },
    { code: "4241", word: "Mure" },
    { code: "5251", word: "Nappe" },
    { code: "5251", word: "Natte" },
    { code: "7241", word: "Navette" },
    { code: "3201", word: "Nez" },
    { code: "5251", word: "Niche" },
    { code: "3201", word: "Nid" },
    { code: "4231", word: "Noix" },
    { code: "4241", word: "Note" },
    { code: "5231", word: "Nuage" },
    { code: "4301", word: "Noeud" },
    { code: "3123", word: "Oie" },
    { code: "6123", word: "Oignon" },
    { code: "6123", word: "Oiseau" },
    { code: "5153", word: "Ongle" },
    { code: "5133", word: "Orage" },
    { code: "6133", word: "Orange" },
    { code: "7133", word: "Oreille" },
    { code: "8133", word: "Oreiller" },
    { code: "5143", word: "Orgue" },    { code: "1143", word: "Ornithorynque" },
    { code: "6143", word: "Orteil" },
    { code: "2103", word: "Os" },
    { code: "4123", word: "Ours" },
    { code: "4242", word: "Page" },
    { code: "4232", word: "Pain" },
    { code: "6242", word: "Palace" },
    { code: "7242", word: "Palette" },
    { code: "5252", word: "Palme" },
    { code: "7252", word: "Palmier" },
    { code: "5252", word: "Panda" },
    { code: "6242", word: "Panier" },
    { code: "8252", word: "Pantalon" },
    { code: "8262", word: "Panthere" },
    { code: "4232", word: "Paon" },
    { code: "8242", word: "Papillon" },
    { code: "6242", word: "Paquet" },
    { code: "8242", word: "Parabole" },
    { code: "9242", word: "Parachute" },
    { code: "9242", word: "Parapluie" },
    { code: "9262", word: "Parchemin" },
    { code: "9252", word: "Partition" },
    { code: "8252", word: "Passoire" },
    { code: "8252", word: "Pasteque" },
    { code: "5232", word: "Paume" },
    { code: "6232", word: "Peigne" },
    { code: "5252", word: "Pelle" },
    { code: "6242", word: "Pelote" },
    { code: "9252", word: "Pendentif" },
    { code: "7252", word: "Pendule" },
    { code: "8252", word: "Perceuse" },
    { code: "9252", word: "Perfusion" },
    { code: "5252", word: "Perle" },
    { code: "9252", word: "Perroquet" },
    { code: "8252", word: "Perruche" },
    { code: "6252", word: "Persil" },
    { code: "7352", word: "Pharaon" },
    { code: "5352", word: "Phare" },
    { code: "6352", word: "Phoque" },
    { code: "5232", word: "Piano" },
    { code: "6252", word: "Pichet" },
    { code: "4232", word: "Pied" },
    { code: "6242", word: "Pigeon" },
    { code: "4242", word: "Pile" },
    { code: "6242", word: "Piment" },
    { code: "3202", word: "Pin" },
    { code: "5252", word: "Pince" },
    { code: "7252", word: "Pinceau" },
    { code: "8252", word: "Pingouin" },
    { code: "6232", word: "Piolet" },    { code: "4232", word: "Pion" },
    { code: "4242", word: "Pipe" },
    { code: "7252", word: "Piscine" },
    { code: "8252", word: "Pistolet" },
    { code: "5232", word: "Piece" },
    { code: "7352", word: "Placard" },
    { code: "4302", word: "Plan" },
    { code: "7372", word: "Planche" },
    { code: "6362", word: "Plante" },
    { code: "7352", word: "Planete" },
    { code: "4302", word: "Plat" },
    { code: "8362", word: "Plongeur" },
    { code: "5352", word: "Plume" },
    { code: "4342", word: "Pneu" },
    { code: "5252", word: "Poche" },
    { code: "5232", word: "Poids" },
    { code: "7232", word: "Poignee" },
    { code: "5232", word: "Poing" },
    { code: "5232", word: "Point" },
    { code: "5232", word: "Poire" },
    { code: "7232", word: "Poireau" },
    { code: "4232", word: "Pois" },
    { code: "7232", word: "Poisson" },
    { code: "7232", word: "Poivron" },
    { code: "5252", word: "Pomme" },
    { code: "5252", word: "Pompe" },
    { code: "4202", word: "Pont" },
    { code: "4202", word: "Porc" },
    { code: "5252", word: "Porte" },
    { code: "1252", word: "Portefeuille" },
    { code: "3202", word: "Pot" },
    { code: "6242", word: "Poteau" },
    { code: "8232", word: "Poubelle" },
    { code: "5232", word: "Pouce" },
    { code: "5232", word: "Poule" },
    { code: "6232", word: "Poulet" },
    { code: "6232", word: "Poulpe" },
    { code: "7232", word: "Poumons" },
    { code: "6232", word: "Poupee" },
    { code: "7232", word: "Poussin" },
    { code: "5232", word: "Poele" },
    { code: "5352", word: "Prise" },
    { code: "6352", word: "Prison" },
    { code: "0352", word: "Projecteur" },
    { code: "5352", word: "Prune" },
    { code: "3302", word: "Pre" },
    { code: "5232", word: "Puits" },
    { code: "4202", word: "Pull" },
    { code: "7242", word: "Punaise" },
    { code: "6262", word: "Puzzle" },    { code: "8242", word: "Pyramide" },
    { code: "6242", word: "Pedale" },
    { code: "7242", word: "Pelican" },
    { code: "6242", word: "Petard" },
    { code: "5252", word: "Peche" },
    { code: "5232", word: "Queue" },
    { code: "6232", word: "Quille" },
    { code: "5242", word: "Rabot" },
    { code: "6242", word: "Radeau" },
    { code: "5242", word: "Radis" },
    { code: "4232", word: "Raie" },
    { code: "6232", word: "Raisin" },
    { code: "4242", word: "Rame" },
    { code: "8242", word: "Raquette" },
    { code: "6242", word: "Rasoir" },
    { code: "3202", word: "Rat" },
    { code: "5232", word: "Reine" },
    { code: "6242", word: "Renard" },
    { code: "5252", word: "Renne" },
    { code: "6242", word: "Requin" },
    { code: "8242", word: "Revolver" },
    { code: "0352", word: "Rhinoceros" },
    { code: "4242", word: "Robe" },
    { code: "7242", word: "Robinet" },
    { code: "5242", word: "Robot" },
    { code: "4242", word: "Rose" },
    { code: "4232", word: "Roue" },
    { code: "5232", word: "Rouet" },
    { code: "7232", word: "Rouleau" },
    { code: "5232", word: "Route" },
    { code: "5242", word: "Ruban" },
    { code: "5252", word: "Ruche" },
    { code: "6242", word: "Rateau" },
    { code: "5252", word: "Regle" },
    { code: "1252", word: "Retroprojecteur" },
    { code: "9242", word: "Reverbere" },
    { code: "7253", word: "Sablier" },
    { code: "5243", word: "Sabot" },
    { code: "5253", word: "Sabre" },
    { code: "3203", word: "Sac" },
    { code: "7243", word: "Sacoche" },
    { code: "5233", word: "Saint" },
    { code: "6243", word: "Salade" },
    { code: "7243", word: "Saliere" },
    { code: "8263", word: "Sandwich" },
    { code: "4203", word: "Sang" },
    { code: "8263", word: "Sanglier" },
    { code: "5243", word: "Sapin" },
    { code: "9243", word: "Satellite" },
    { code: "0233", word: "Sauterelle" },    { code: "9243", word: "Saxophone" },
    { code: "1363", word: "Scaphandrier" },
    { code: "8353", word: "Scarabee" },
    { code: "4343", word: "Scie" },
    { code: "8363", word: "Scorpion" },
    { code: "4233", word: "Seau" },
    { code: "4233", word: "Sein" },
    { code: "3203", word: "Sel" },
    { code: "5253", word: "Selle" },
    { code: "8243", word: "Seringue" },
    { code: "5253", word: "Serpe" },
    { code: "7253", word: "Serpent" },
    { code: "0253", word: "Serviettes" },
    { code: "7263", word: "Sifflet" },
    { code: "5253", word: "Signe" },
    { code: "5253", word: "Singe" },
    { code: "6243", word: "Sirene" },
    { code: "3303", word: "Ski" },
    { code: "6253", word: "Soldat" },
    { code: "4243", word: "Sole" },
    { code: "6243", word: "Soleil" },
    { code: "8263", word: "Sombrero" },
    { code: "8253", word: "Soricere" },
    { code: "6233", word: "Souris" },
    { code: "9363", word: "Spaghetti" },
    { code: "9353", word: "Sparadrap" },
    { code: "7353", word: "Spatule" },
    { code: "6403", word: "Sphinx" },
    { code: "9343", word: "Squelette" },
    { code: "6353", word: "Statue" },
    { code: "5353", word: "Stylo" },
    { code: "1363", word: "Stethoscope" },
    { code: "4243", word: "Sumo" },
    { code: "5251", word: "Table" },
    { code: "7251", word: "Tableau" },
    { code: "8241", word: "Tabouret" },
    { code: "5241", word: "Talon" },
    { code: "6251", word: "Tamtam" },
    { code: "7251", word: "Tambour" },
    { code: "9251", word: "Tambourin" },
    { code: "6251", word: "Tampon" },
    { code: "4201", word: "Tank" },
    { code: "5241", word: "Tapis" },
    { code: "5251", word: "Tarte" },
    { code: "7251", word: "Tartine" },
    { code: "5251", word: "Tasse" },
    { code: "5241", word: "Tatou" },
    { code: "5231", word: "Taupe" },
    { code: "5251", word: "Tente" },
    { code: "1361", word: "Thermometre" },    { code: "7361", word: "Thermos" },
    { code: "6251", word: "Ticket" },
    { code: "5251", word: "Tigre" },
    { code: "6261", word: "Timbre" },
    { code: "8241", word: "Tirelire" },
    { code: "6241", word: "Tiroir" },
    { code: "5231", word: "Toile" },
    { code: "8231", word: "Toilette" },
    { code: "4231", word: "Toit" },
    { code: "6241", word: "Tomate" },
    { code: "5251", word: "Tombe" },
    { code: "8251", word: "Tondeuse" },
    { code: "7251", word: "Tonneau" },
    { code: "5241", word: "Toque" },
    { code: "6261", word: "Torche" },
    { code: "7261", word: "Torchon" },
    { code: "6251", word: "Tortue" },
    { code: "5241", word: "Totem" },
    { code: "6231", word: "Toucan" },
    { code: "6231", word: "Toupie" },
    { code: "9231", word: "Tournevis" },
    { code: "8361", word: "Tracteur" },
    { code: "1361", word: "Tractopelle" },
    { code: "5341", word: "Train" },
    { code: "0361", word: "Transistor" },
    { code: "6351", word: "Tricot" },
    { code: "8361", word: "Trombone" },
    { code: "9361", word: "Trompette" },
    { code: "5301", word: "Tronc" },
    { code: "7341", word: "Trousse" },
    { code: "7341", word: "Truelle" },
    { code: "6361", word: "Trefle" },
    { code: "6351", word: "Tresor" },
    { code: "5351", word: "Trone" },
    { code: "4241", word: "Tuba" },
    { code: "4241", word: "Tube" },
    { code: "5231", word: "Tuile" },
    { code: "6251", word: "Tunnel" },
    { code: "5231", word: "Tuyau" },
    { code: "9241", word: "Telescope" },
    { code: "9241", word: "Telephone" },
    { code: "0241", word: "Television" },
    { code: "6241", word: "Tetine" },
    { code: "4142", word: "Urne" },
    { code: "5132", word: "Usine" },
    { code: "5251", word: "Vache" },
    { code: "6241", word: "Valise" },
    { code: "4241", word: "Vase" },
    { code: "7231", word: "Vautour" },
    { code: "1251", word: "Ventilateur" },    { code: "3201", word: "Ver" },
    { code: "5251", word: "Verre" },
    { code: "6251", word: "Verrou" },
    { code: "5251", word: "Veste" },
    { code: "5251", word: "Ville" },
    { code: "5201", word: "Vingt" },
    { code: "6231", word: "Violon" },
    { code: "3201", word: "Vis" },
    { code: "5231", word: "Voile" },
    { code: "7231", word: "Voilier" },
    { code: "7231", word: "Voiture" },
    { code: "6241", word: "Volant" },
    { code: "6251", word: "Volcan" },
    { code: "4241", word: "Velo" },
    { code: "5241", word: "Wagon" },
    { code: "4121", word: "Yoyo" },
    { code: "5251", word: "Zebre" },
    { code: "7141", word: "Echarpe" },
    { code: "7141", word: "Echelle" },
    { code: "6141", word: "Eclair" },
    { code: "9131", word: "Ecouteurs" },
    { code: "5141", word: "Ecran" },
    { code: "5141", word: "Ecrou" },
    { code: "8131", word: "Ecureuil" },
    { code: "6141", word: "Eglise" },
    { code: "4131", word: "Elan" },
    { code: "8131", word: "Elephant" },
    { code: "0141", word: "Eprouvette" },
    { code: "4131", word: "Epee" },
    { code: "7131", word: "Equerre" },
    { code: "6131", word: "Etabli" },
    { code: "7131", word: "Etalage" },
    { code: "9131", word: "Etiquette" },
    { code: "6131", word: "Etoile" },
    { code: "8131", word: "Eventail" },
    { code: "5131", word: "Evier" },
    { code: "4123", word: "Oeil" },
    { code: "4123", word: "Oeuf" },
    { code: "7252", word: "Billard" },
    { code: "6363", word: "Chicha" },
    { code: "6303", word: "Scotch" },
    { code: "7352", word: "Plateau" },
    { code: "0143", word: "Ordinateur" },
    { code: "0242", word: "Bicyclette" },
    { code: "1353", word: "Climatiseur" },
    { code: "1352", word: "Preservatif" },
    { code: "8231", word: "Noisette" },
    { code: "7253", word: "Costume" },
    { code: "9141", word: "Ascenseur" },
    { code: "1253", word: "Congelateur" },    { code: "1252", word: "Refrigerateur" },
    { code: "8251", word: "Tablette" },
    { code: "9232", word: "Deodorant" },
    { code: "7233", word: "Coussin" },
    { code: "4241", word: "Vape" },
    { code: "4231", word: "Miel" },
    { code: "8231", word: "Mouchoir" },
    { code: "8253", word: "Commande" },
    { code: "7252", word: "Panneau" },
    { code: "7241", word: "Liquide" },
    { code: "6232", word: "Poudre" },
    { code: "8252", word: "Perruque" },
    { code: "6252", word: "Parfum" },
    { code: "0251", word: "Lubrifiant" },
    { code: "6352", word: "Plaque" },
    { code: "8251", word: "Matraque" },
    { code: "6253", word: "Calson" },
    { code: "7243", word: "Culotte" },
    { code: "6251", word: "Vernis" },
    { code: "3121", word: "Eau" },
    { code: "6253", word: "Sachet" },
    { code: "5343", word: "Choux" },
    { code: "8343", word: "Chouette" },
    { code: "5241", word: "Figue" },
    { code: "0251", word: "Microphone" },
    { code: "8252", word: "Girlande" },
    { code: "6251", word: "Vaccin" },
    { code: "7342", word: "Blouson" },
    { code: "7241", word: "Lasagne" },
    { code: "6252", word: "Burger" },
    { code: "5252", word: "Pizza" },
    { code: "8233", word: "Couscous" },
    { code: "7251", word: "Mascara" },
    { code: "5242", word: "Jeton" },
    { code: "8141", word: "Immeuble" },
    { code: "8242", word: "Batiment" },
    { code: "6242", word: "Rideau" },
    { code: "7241", word: "Matelas" },
    { code: "7233", word: "Couette" },
    { code: "8232", word: "Peignoir" },
    { code: "9253", word: "Serviette" },
    { code: "9363", word: "Shampoing" },
    { code: "5243", word: "Savon" },
    { code: "0252", word: "Dentifrice" },
    { code: "9233", word: "Couvercle" },
    { code: "5242", word: "Bidon" },
    { code: "7253", word: "Sechoir" },
    { code: "7253", word: "Serrure" },
    { code: "3303", word: "Cle" },
    { code: "5253", word: "Cable" },    { code: "8363", word: "Chargeur" },
    { code: "7232", word: "Routeur" },
    { code: "5241", word: "Modem" },
    { code: "7241", word: "Manette" },
    { code: "8232", word: "Joystick" },
    { code: "0151", word: "Imprimante" },
    { code: "7363", word: "Scanner" },
    { code: "4231", word: "Neon" },
    { code: "8251", word: "Ventouse" },
    { code: "7241", word: "Ficelle" },
    { code: "9253", word: "Corbeille" },
    { code: "7251", word: "Tablier" },
    { code: "7361", word: "Flasque" },
    { code: "7242", word: "Gobelet" },
    { code: "8351", word: "Friteuse" },
    { code: "7233", word: "Cuiseur" },
    { code: "6241", word: "Mixeur" },
    { code: "7362", word: "Blender" },
    { code: "0362", word: "Grillepain" },
    { code: "6141", word: "Ampere" },
    { code: "1241", word: "Telecommande" },
    { code: "8131", word: "Abatjour" },
    { code: "7141", word: "Adhesif" },
    { code: "6141", word: "Alcool" },
    { code: "8131", word: "Aquarium" },
    { code: "9252", word: "Banderole" },
    { code: "6252", word: "Bassin" },
    { code: "6342", word: "Blouse" },
    { code: "7232", word: "Boitier" },
    { code: "7342", word: "Brioche" },
    { code: "9243", word: "Cafetiere" },
    { code: "7243", word: "Cagoule" },
    { code: "9243", word: "Camembert" },
    { code: "8243", word: "Capuchon" },
    { code: "9253", word: "Carburant" },
    { code: "9343", word: "Chaudiere" },
    { code: "7363", word: "Chiffon" },
    { code: "4243", word: "Cire" },
    { code: "6353", word: "Clapet" },
    { code: "5243", word: "Colis" },
    { code: "0253", word: "Condenseur" },
    { code: "0253", word: "Contacteur" },
    { code: "9253", word: "Conteneur" },
    { code: "5243", word: "Coton" },
    { code: "5233", word: "Coude" },
    { code: "8233", word: "Couverts" },
    { code: "7353", word: "Crapaud" },
    { code: "7353", word: "Cremier" },
    { code: "4303", word: "Cric" },
    { code: "4243", word: "Cuve" },    { code: "0242", word: "Deboucheur" },
    { code: "1242", word: "Decapsuleur" },
    { code: "9252", word: "Diffuseur" },
    { code: "6242", word: "Dynamo" },
    { code: "9131", word: "Elastique" },
    { code: "6141", word: "Embout" },
    { code: "8131", word: "Emetteur" },
    { code: "8151", word: "Entrepot" },
    { code: "7131", word: "Epingle" },
    { code: "8361", word: "Flotteur" },
    { code: "8231", word: "Fourreau" },
    { code: "7241", word: "Fusible" },
    { code: "5232", word: "Gaine" },
    { code: "7242", word: "Galette" },
    { code: "5242", word: "Gazon" },
    { code: "7242", word: "Gilette" },
    { code: "4202", word: "Gond" },
    { code: "7232", word: "Gourdin" },
    { code: "6232", word: "Poulie" },
    { code: "5251", word: "Vitre" },
    { code: "6232", word: "Paille" },
    { code: "9131", word: "Atomiseur" },
    { code: "3202", word: "Box" },
    { code: "6263", word: "Cendre" },
    { code: "9232", word: "Poussiere" },
    { code: "8233", word: "Cailloux" },
    { code: "7233", word: "Caillou" },
    { code: "4241", word: "Tige" },
    { code: "6241", word: "Farine" },
    { code: "6262", word: "Baffle" },
    { code: "4242", word: "Puce" },
    { code: "5242", word: "Baton" },
    { code: "8242", word: "Batonnet" },
    { code: "7141", word: "Affiche" },
    { code: "8252", word: "Pancarte" },
    { code: "7253", word: "Support" },
    { code: "7232", word: "Poignet" },
    { code: "7351", word: "Trepied" },
    { code: "7242", word: "Peluche" },
    { code: "5253", word: "Sable" },
    { code: "6352", word: "Glacon" },
    { code: "7251", word: "Mosquee" },
    { code: "6261", word: "Lustre" },
    { code: "5242", word: "Radio" },
    { code: "4121", word: "Yoat" },
    { code: "5253", word: "Sucre" },
  { code: "7243", word: "Sucette" },
  { code: "7231", word: "Foulard" },
  { code: "4303", word: "Char" },
  { code: "6243", word: "Cafard" },
  { code: "7353", word: "Chariot" },
  { code: "8141", word: "Alliance" },
  { code: "8252", word: "Barriere" },
  { code: "7252", word: "Barrage" },
  { code: "1252", word: "Retroviseur" },
  { code: "7242", word: "Parasol" },
  { code: "0361", word: "Trampoline" },
  { code: "5241", word: "Taser" },
  { code: "8232", word: "Piercing" },
  { code: "8241", word: "Magazine" },
  { code: "5242", word: "Revue" },
  { code: "5303", word: "Short" },
  { code: "5231", word: "Huile" },
  { code: "4241", word: "Taxi" },
  { code: "1262", word: "Pamplemousse" },
  { code: "6252", word: "Jardin" },
  { code: "7251", word: "Terrain" },
  { code: "1361", word: "Trottinette" },
  { code: "5241", word: "Musee" },
  { code: "7363", word: "Charbon" },
  { code: "5141", word: "Echec" },
  { code: "1243", word: "Supermarche" },
  { code: "7241", word: "Magasin" },
  { code: "9131", word: "Aluminium" },
  { code: "3231", word: "Zoo" },
  { code: "8241", word: "Tatouage" },
  { code: "4131", word: "Etui" },
  { code: "6252", word: "Poster" },
  { code: "6243", word: "Cinema" },
  { code: "0252", word: "Restaurant" },
  { code: "6241", word: "Tisane" },
  { code: "5353", word: "Stade" },
  { code: "1141", word: "Appartement" },
  { code: "7141", word: "Ardoise" },
  { code: "4202", word: "Port" },
  { code: "8121", word: "Aeroport" },
  { code: "5232", word: "Jouet" },
  { code: "3232", word: "Jeu" },
  { code: "7253", word: "Cascade" },
  { code: "7242", word: "Gamelle" },
  { code: "7241", word: "Harissa" },
  { code: "5141", word: "Algue" },
  { code: "6252", word: "Bassin" },
  { code: "6232", word: "Bierre" },
  { code: "7373", word: "Chambre" },
  { code: "5242", word: "Dague" },
  { code: "8252", word: "Pochette" },
  { code: "9252", word: "Pellicule" },
  { code: "4242", word: "Pate" },
  { code: "5242", word: "Poney" },
  { code: "6251", word: "Webcam" },
  { code: "7261", word: "Walkman" },
  { code: "6251", word: "Zipper" },
  { code: "6232", word: "Quartz" },
  { code: "5201", word: "Yacht" },
  { code: "8251", word: "Fontaine" }
    ];

    const defaultSettings = {
        wordsY: 265, wordsSize: 18, wordsColor: '#ffffff', wordsLineHeight: 15,
        lettersY: 460, lettersSize: 20, lettersColor: '#ffffff', lettersSpacing: 40,
        indexY: 517, indexSize: 30, indexColor: '#1E6FF0', indexX: -45
    };

    const defaultNoteSettings = {
        noteX: 0,
        noteY: 262,
        noteSize: 18,
        noteColor: '#ffffff',
        noteLineHeight: 15
    };

    let pin = '', currentCode = '', originalWords = [], currentWords = [];
    let letterLists = [], bestListIndex = -1, bestListLetters = [];
    let selectedLetter = '', lastTap = 0, isPreviewMode = false;
    let isSearchDisabled = false, keyboardVisible = false;
    let resizeTimeout, blurTimeout, currentPreviewTarget = '', currentPreviewData = '';
    let currentSettings = { ...defaultSettings };
    let currentNoteSettings = { ...defaultNoteSettings };
    let noteModeActive = false;
    let noteLastTap = 0;
    let indexClickCount = 0;
    let indexClickTimer = null;
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            indexClickCount = 0;
            clearTimeout(indexClickTimer);
            wordsContainer.classList.add('hidden');
            lettersContainer.classList.add('hidden');
            noteModeActive = false;
            indexDisplay.classList.remove('note-mode-active');
        }
    });

    function resetAfterNotePageClose() {
        indexClickCount = 0;
        clearTimeout(indexClickTimer);
        wordsContainer.classList.add('hidden');
        lettersContainer.classList.add('hidden');
        noteModeActive = false;
        indexDisplay.classList.remove('note-mode-active');
    }

    window.addEventListener('resize', function() {
        if (window.innerHeight < window.screen.height - 200) {
            keyboardVisible = true;
            modal.classList.add('keyboard-open');
        } else {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (document.activeElement !== searchInput) {
                    keyboardVisible = false;
                    modal.classList.remove('keyboard-open');
                }
            }, 300);
        }
    });

    searchInput.addEventListener('focus', function() { keyboardVisible = true; modal.classList.add('keyboard-open'); });
    searchInput.addEventListener('blur', function() {
        clearTimeout(blurTimeout);
        blurTimeout = setTimeout(() => { keyboardVisible = false; modal.classList.remove('keyboard-open'); }, 300);
    });

    function searchWord(word) {
        const normalized = word.trim().toLowerCase();
        for (let i = 0; i < wordsList.length; i++) {
            if (wordsList[i].word.toLowerCase() === normalized) return wordsList[i];
        }
        return null;
    }

    function enableSearchButton() { searchBtn.classList.remove('disabled'); isSearchDisabled = false; codeResult.textContent = ''; codeResult.classList.remove('error'); }    function disableSearchButton() { searchBtn.classList.add('disabled'); isSearchDisabled = true; }

    function loadCustomSettings() {
        try { const saved = localStorage.getItem('customSettings'); if (saved) return JSON.parse(saved); } catch(e) {}
        return { ...defaultSettings };
    }

    function saveCustomSettings(settings) { try { localStorage.setItem('customSettings', JSON.stringify(settings)); } catch(e) {} }

    function loadNoteSettings() {
        try { const saved = localStorage.getItem('noteSettings'); if (saved) return JSON.parse(saved); } catch(e) {}
        return { ...defaultNoteSettings };
    }

    function saveNoteSettings(settings) { try { localStorage.setItem('noteSettings', JSON.stringify(settings)); } catch(e) {} }

    function applyCustomSettings(settings) {
        wordsContainer.style.top = settings.wordsY + 'px';
        wordsContainer.style.fontSize = settings.wordsSize + 'px';
        wordsContainer.style.color = settings.wordsColor;
        wordsContainer.style.lineHeight = settings.wordsLineHeight + 'px';
        lettersContainer.style.top = settings.lettersY + 'px';
        lettersContainer.style.fontSize = settings.lettersSize + 'px';
        lettersContainer.style.color = settings.lettersColor;
        lettersContainer.style.gap = settings.lettersSpacing + 'px';
        indexDisplay.style.top = settings.indexY + 'px';
        indexDisplay.style.fontSize = settings.indexSize + 'px';
        indexDisplay.style.color = settings.indexColor;
        indexDisplay.style.transform = 'translateX(calc(-50% + ' + settings.indexX + 'px))';
        
        wordsYValue.textContent = settings.wordsY + 'px';
        wordsSizeValue.textContent = settings.wordsSize + 'px';
        wordsLineHeightValue.textContent = settings.wordsLineHeight + 'px';
        lettersYValue.textContent = settings.lettersY + 'px';
        lettersSizeValue.textContent = settings.lettersSize + 'px';
        lettersSpacingValue.textContent = settings.lettersSpacing + 'px';
        indexYValue.textContent = settings.indexY + 'px';
        indexSizeValue.textContent = settings.indexSize + 'px';
        indexXValue.textContent = settings.indexX + 'px';
        
        wordsY.value = settings.wordsY; wordsSize.value = settings.wordsSize; wordsColor.value = settings.wordsColor;
        wordsLineHeight.value = settings.wordsLineHeight; lettersY.value = settings.lettersY;
        lettersSize.value = settings.lettersSize; lettersColor.value = settings.lettersColor;
        lettersSpacing.value = settings.lettersSpacing; indexY.value = settings.indexY;
        indexSize.value = settings.indexSize; indexColor.value = settings.indexColor;
        indexX.value = settings.indexX;
    }

    function applyNoteSettings(settings) {
        // ‚úÖ CORRECTION : Sans -50%        noteWordsContainer.style.transform = 'translateX(' + settings.noteX + 'px)';
        noteWordsContainer.style.top = settings.noteY + 'px';
        noteWordsContainer.style.fontSize = settings.noteSize + 'px';
        noteWordsContainer.style.color = settings.noteColor;
        noteWordsContainer.style.lineHeight = settings.noteLineHeight + 'px';
        
        noteXValue.textContent = settings.noteX + 'px';
        noteYValue.textContent = settings.noteY + 'px';
        noteSizeValue.textContent = settings.noteSize + 'px';
        noteLineHeightValue.textContent = settings.noteLineHeight + 'px';
        
        noteX.value = settings.noteX;
        noteY.value = settings.noteY;
        noteSize.value = settings.noteSize;
        noteColor.value = settings.noteColor;
        noteLineHeight.value = settings.noteLineHeight;
    }

    // ‚úÖ CORRECTION : Sans -50% pour position X fixe
    function applyNoteSettingsToNotePage(settings) {
        noteText.style.transform = 'translateX(' + settings.noteX + 'px)';
        noteText.style.top = settings.noteY + 'px';
        noteText.style.fontSize = settings.noteSize + 'px';
        noteText.style.color = settings.noteColor;
        noteText.style.lineHeight = settings.noteLineHeight + 'px';
    }

    function generateAcrostic(word) {
        let result = [];
        let usedWords = new Set();
        let originalWord = word.toUpperCase().trim();
        
        for (let letter of originalWord) {
            let matches = wordsList.filter(w => {
                let wordUpper = w.word.toUpperCase().trim();
                return wordUpper.startsWith(letter) && 
                       wordUpper !== originalWord;
            });
            
            let available = matches.filter(w => !usedWords.has(w.word.toUpperCase().trim()));
            
            if (available.length > 0) {
                let random = available[Math.floor(Math.random() * available.length)];
                usedWords.add(random.word.toUpperCase().trim());
                
                let firstLetter = random.word.charAt(0);
                let rest = random.word.slice(1);
                result.push(`<u>${firstLetter}</u>${rest}`);
            } else {
                result.push(`<u>${letter}</u>`);            }
        }
        
        return result.join('<br>');
    }

    function updatePreviewWithCode(code) {
        if (code.length !== 4) return;
        currentCode = code;
        originalWords = wordsList.filter(function(w) { return w.code === code; }).map(function(w) { return w.word; });
        originalWords.sort(function(a, b) { return a.localeCompare(b); });
        currentWords = originalWords.slice();
        
        var firstDigit = parseInt(code[0]);
        letterLists = [];
        for (var pos = 0; pos < firstDigit; pos++) {
            letterLists[pos] = [];
            for (var i = 0; i < originalWords.length; i++) {
                var word = originalWords[i];
                if (word.length > pos && letterLists[pos].indexOf(word[pos]) === -1) {
                    letterLists[pos].push(word[pos]);
                }
            }
            letterLists[pos].sort();
        }
        
        bestListIndex = -1;
        var maxSize = 0;
        for (var i = 0; i < letterLists.length; i++) {
            if (letterLists[i].length > maxSize) {
                maxSize = letterLists[i].length;
                bestListIndex = i;
            }
        }
        bestListLetters = bestListIndex !== -1 ? letterLists[bestListIndex] : [];
        indexDisplay.textContent = bestListIndex !== -1 ? (bestListIndex + 1).toString() : '';
        displayWords(currentWords);
        displayLetterButtons(bestListIndex, bestListLetters);
        wordsContainer.classList.remove('hidden');
        lettersContainer.classList.remove('hidden');
    }

    function displayWords(words) {
        wordsContainer.innerHTML = '';
        if (words.length === 0) {
            wordsContainer.innerHTML = '<div class="words-line">Aucun mot</div>';
            return;
        }
        var line = document.createElement('div');
        line.className = 'words-line';        for (var i = 0; i < words.length; i++) {
            var word = words[i];
            var span = document.createElement('span');
            span.className = 'result-word';
            span.textContent = word;
            (function(w) {
                span.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (noteModeActive) {
                        openNotePage(w);
                    } else {
                        window.open('https://www.google.com/search?tbm=isch&q=' + encodeURIComponent(w), '_blank');
                    }
                });
            })(word);
            line.appendChild(span);
            if (i < words.length - 1) line.appendChild(document.createTextNode(' '));
        }
        wordsContainer.appendChild(line);
    }

    function openNotePage(word) {
        currentNoteSettings = loadNoteSettings();
        applyNoteSettingsToNotePage(currentNoteSettings);
        
        let acrostic = generateAcrostic(word);
        noteText.innerHTML = acrostic;
        
        var noteBg = customizeNotePage.style.backgroundImage;
        if (noteBg) {
            notePage.style.backgroundImage = noteBg;
        }
        notePage.classList.add('visible');
        
        noteText.contentEditable = "true";
        noteText.focus();
    }

    function displayLetterButtons(index, letters) {
        lettersContainer.innerHTML = '';
        if (letters.length === 0) return;
        for (var i = 0; i < letters.length; i++) {
            var letter = letters[i];
            var span = document.createElement('span');
            span.className = 'letter-btn' + (selectedLetter === letter ? ' selected' : '');
            span.textContent = letter.toUpperCase();
            (function(ltr) {
                span.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (selectedLetter === ltr) {                        selectedLetter = '';
                        currentWords = originalWords.slice();
                    } else {
                        selectedLetter = ltr;
                        currentWords = originalWords.filter(function(w) { return w[index] === ltr; });
                    }
                    var btns = document.querySelectorAll('.letter-btn');
                    for (var j = 0; j < btns.length; j++) btns[j].classList.remove('selected');
                    if (selectedLetter) span.classList.add('selected');
                    displayWords(currentWords);
                });
            })(letter);
            lettersContainer.appendChild(span);
            if (i < letters.length - 1) {
                var spacer = document.createElement('span');
                spacer.innerHTML = '    ';
                lettersContainer.appendChild(spacer);
            }
        }
    }

    function startDragging() { 
        if (customizePage.classList.contains('visible')) {
            customizePage.classList.add('dragging-slider'); 
            resultPage.classList.add('dragging-active');
        }
        if (customizeNotePage.classList.contains('visible')) {
            customizeNotePage.classList.add('dragging-slider');
        }
    }
    function stopDragging() { 
        customizePage.classList.remove('dragging-slider'); 
        resultPage.classList.remove('dragging-active');
        customizeNotePage.classList.remove('dragging-slider');
    }
    var allSliders = [wordsY, wordsSize, wordsLineHeight, lettersY, lettersSize, lettersSpacing, indexY, indexSize, indexX, noteX, noteY, noteSize, noteLineHeight];
    for (var i = 0; i < allSliders.length; i++) {
        if (allSliders[i]) {
            allSliders[i].addEventListener('touchstart', startDragging);
            allSliders[i].addEventListener('touchend', stopDragging);
            allSliders[i].addEventListener('touchcancel', stopDragging);
        }
    }

    var previewBtns = [previewListBtn, previewLettersBtn, previewIndexBtn, previewNoteBtn];
    for (var i = 0; i < previewBtns.length; i++) {
        if (previewBtns[i]) {
            previewBtns[i].addEventListener('touchstart', startDragging);
            previewBtns[i].addEventListener('touchend', stopDragging);
            previewBtns[i].addEventListener('touchcancel', stopDragging);        }
    }

    function resetToDefault(setting, defaultValue) {
        return function() {
            currentSettings[setting] = defaultValue;
            
            if (setting === 'wordsY') {
                wordsContainer.style.top = defaultValue + 'px';
                wordsYValue.textContent = defaultValue + 'px';
                wordsY.value = defaultValue;
            }
            else if (setting === 'wordsSize') {
                wordsContainer.style.fontSize = defaultValue + 'px';
                wordsSizeValue.textContent = defaultValue + 'px';
                wordsSize.value = defaultValue;
            }
            else if (setting === 'wordsLineHeight') {
                wordsContainer.style.lineHeight = defaultValue + 'px';
                wordsLineHeightValue.textContent = defaultValue + 'px';
                wordsLineHeight.value = defaultValue;
            }
            else if (setting === 'lettersY') {
                lettersContainer.style.top = defaultValue + 'px';
                lettersYValue.textContent = defaultValue + 'px';
                lettersY.value = defaultValue;
            }
            else if (setting === 'lettersSize') {
                lettersContainer.style.fontSize = defaultValue + 'px';
                lettersSizeValue.textContent = defaultValue + 'px';
                lettersSize.value = defaultValue;
            }
            else if (setting === 'lettersSpacing') {
                lettersContainer.style.gap = defaultValue + 'px';
                lettersSpacingValue.textContent = defaultValue + 'px';
                lettersSpacing.value = defaultValue;
            }
            else if (setting === 'indexY') {
                indexDisplay.style.top = defaultValue + 'px';
                indexYValue.textContent = defaultValue + 'px';
                indexY.value = defaultValue;
            }
            else if (setting === 'indexSize') {
                indexDisplay.style.fontSize = defaultValue + 'px';
                indexSizeValue.textContent = defaultValue + 'px';
                indexSize.value = defaultValue;
            }
            else if (setting === 'indexX') {
                indexDisplay.style.transform = 'translateX(calc(-50% + ' + defaultValue + 'px))';
                indexXValue.textContent = defaultValue + 'px';                indexX.value = defaultValue;
            }
        };
    }

    function resetNoteToDefault(setting, defaultValue) {
        return function() {
            currentNoteSettings[setting] = defaultValue;
            
            if (setting === 'noteX') {
                noteWordsContainer.style.transform = 'translateX(' + defaultValue + 'px)';
                noteXValue.textContent = defaultValue + 'px';
                noteX.value = defaultValue;
            }
            else if (setting === 'noteY') {
                noteWordsContainer.style.top = defaultValue + 'px';
                noteYValue.textContent = defaultValue + 'px';
                noteY.value = defaultValue;
            }
            else if (setting === 'noteSize') {
                noteWordsContainer.style.fontSize = defaultValue + 'px';
                noteSizeValue.textContent = defaultValue + 'px';
                noteSize.value = defaultValue;
            }
            else if (setting === 'noteLineHeight') {
                noteWordsContainer.style.lineHeight = defaultValue + 'px';
                noteLineHeightValue.textContent = defaultValue + 'px';
                noteLineHeight.value = defaultValue;
            }
        };
    }

    wordsYValue.addEventListener('click', resetToDefault('wordsY', defaultSettings.wordsY));
    wordsSizeValue.addEventListener('click', resetToDefault('wordsSize', defaultSettings.wordsSize));
    wordsLineHeightValue.addEventListener('click', resetToDefault('wordsLineHeight', defaultSettings.wordsLineHeight));
    lettersYValue.addEventListener('click', resetToDefault('lettersY', defaultSettings.lettersY));
    lettersSizeValue.addEventListener('click', resetToDefault('lettersSize', defaultSettings.lettersSize));
    lettersSpacingValue.addEventListener('click', resetToDefault('lettersSpacing', defaultSettings.lettersSpacing));
    indexYValue.addEventListener('click', resetToDefault('indexY', defaultSettings.indexY));
    indexSizeValue.addEventListener('click', resetToDefault('indexSize', defaultSettings.indexSize));
    indexXValue.addEventListener('click', resetToDefault('indexX', defaultSettings.indexX));

    noteXValue.addEventListener('click', resetNoteToDefault('noteX', defaultNoteSettings.noteX));
    noteYValue.addEventListener('click', resetNoteToDefault('noteY', defaultNoteSettings.noteY));
    noteSizeValue.addEventListener('click', resetNoteToDefault('noteSize', defaultNoteSettings.noteSize));
    noteLineHeightValue.addEventListener('click', resetNoteToDefault('noteLineHeight', defaultNoteSettings.noteLineHeight));

    wordsY.addEventListener('input', function(e) { currentSettings.wordsY = parseInt(e.target.value); wordsYValue.textContent = currentSettings.wordsY + 'px'; wordsContainer.style.top = currentSettings.wordsY + 'px'; });
    wordsSize.addEventListener('input', function(e) { currentSettings.wordsSize = parseInt(e.target.value); wordsSizeValue.textContent = currentSettings.wordsSize + 'px'; wordsContainer.style.fontSize = currentSettings.wordsSize + 'px'; });
    wordsColor.addEventListener('input', function(e) { currentSettings.wordsColor = e.target.value; wordsContainer.style.color = currentSettings.wordsColor; });    wordsLineHeight.addEventListener('input', function(e) { currentSettings.wordsLineHeight = parseInt(e.target.value); wordsLineHeightValue.textContent = currentSettings.wordsLineHeight + 'px'; wordsContainer.style.lineHeight = currentSettings.wordsLineHeight + 'px'; });
    lettersY.addEventListener('input', function(e) { currentSettings.lettersY = parseInt(e.target.value); lettersYValue.textContent = currentSettings.lettersY + 'px'; lettersContainer.style.top = currentSettings.lettersY + 'px'; });
    lettersSize.addEventListener('input', function(e) { currentSettings.lettersSize = parseInt(e.target.value); lettersSizeValue.textContent = currentSettings.lettersSize + 'px'; lettersContainer.style.fontSize = currentSettings.lettersSize + 'px'; });
    lettersColor.addEventListener('input', function(e) { currentSettings.lettersColor = e.target.value; lettersContainer.style.color = currentSettings.lettersColor; });
    lettersSpacing.addEventListener('input', function(e) { currentSettings.lettersSpacing = parseInt(e.target.value); lettersSpacingValue.textContent = currentSettings.lettersSpacing + 'px'; lettersContainer.style.gap = currentSettings.lettersSpacing + 'px'; });
    indexY.addEventListener('input', function(e) { currentSettings.indexY = parseInt(e.target.value); indexYValue.textContent = currentSettings.indexY + 'px'; indexDisplay.style.top = currentSettings.indexY + 'px'; });
    indexSize.addEventListener('input', function(e) { currentSettings.indexSize = parseInt(e.target.value); indexSizeValue.textContent = currentSettings.indexSize + 'px'; indexDisplay.style.fontSize = currentSettings.indexSize + 'px'; });
    indexColor.addEventListener('input', function(e) { currentSettings.indexColor = e.target.value; indexDisplay.style.color = currentSettings.indexColor; });
    indexX.addEventListener('input', function(e) { currentSettings.indexX = parseInt(e.target.value); indexXValue.textContent = currentSettings.indexX + 'px'; indexDisplay.style.transform = 'translateX(calc(-50% + ' + currentSettings.indexX + 'px))'; });

    noteX.addEventListener('input', function(e) { currentNoteSettings.noteX = parseInt(e.target.value); noteXValue.textContent = currentNoteSettings.noteX + 'px'; noteWordsContainer.style.transform = 'translateX(' + currentNoteSettings.noteX + 'px)'; });
    noteY.addEventListener('input', function(e) { currentNoteSettings.noteY = parseInt(e.target.value); noteYValue.textContent = currentNoteSettings.noteY + 'px'; noteWordsContainer.style.top = currentNoteSettings.noteY + 'px'; });
    noteSize.addEventListener('input', function(e) { currentNoteSettings.noteSize = parseInt(e.target.value); noteSizeValue.textContent = currentNoteSettings.noteSize + 'px'; noteWordsContainer.style.fontSize = currentNoteSettings.noteSize + 'px'; });
    noteColor.addEventListener('input', function(e) { currentNoteSettings.noteColor = e.target.value; noteWordsContainer.style.color = currentNoteSettings.noteColor; });
    noteLineHeight.addEventListener('input', function(e) { currentNoteSettings.noteLineHeight = parseInt(e.target.value); noteLineHeightValue.textContent = currentNoteSettings.noteLineHeight + 'px'; noteWordsContainer.style.lineHeight = currentNoteSettings.noteLineHeight + 'px'; });

    testCodeInput.addEventListener('input', function(e) {
        var code = e.target.value.trim();
        if (code.length === 4 && /^\d+$/.test(code)) updatePreviewWithCode(code);
    });

    searchInput.addEventListener('input', function() { enableSearchButton(); codeResult.textContent = ''; codeResult.classList.remove('error'); });

    searchBtn.addEventListener('click', function() {
        if (isSearchDisabled) return;
        var word = searchInput.value.trim();
        if (!word) return;
        var result = searchWord(word);
        if (result) {
            codeResult.textContent = result.code;
            codeResult.classList.remove('error');
            disableSearchButton();
            searchInput.blur();
        } else {
            codeResult.textContent = 'Mot introuvable !';
            codeResult.classList.add('error');
        }
    });

    searchInput.addEventListener('keypress', function(e) { if (e.key === 'Enter' && !isSearchDisabled) searchBtn.click(); });

    btnPerform.addEventListener('click', function() {
        homePage.classList.add('hidden');
        lockPage.classList.add('visible');
        pin = '';
        updateDots();
    });

    btnList.addEventListener('click', function() {
        resetModalToNormal();        modal.classList.add('visible');
        modalOverlay.classList.add('visible');
    });

    btnSettings.addEventListener('click', function() {
        homePage.classList.add('hidden');
        settingsPage.classList.add('visible');
    });

    modifyNoteBtn.addEventListener('click', function() {
        settingsPage.classList.remove('visible');
        customizeNotePage.classList.add('visible');
        currentNoteSettings = loadNoteSettings();
        applyNoteSettings(currentNoteSettings);
    });

    customizeBtn.addEventListener('click', function() {
        settingsPage.classList.remove('visible');
        isPreviewMode = true;
        customizePage.classList.add('visible', 'preview-mode');
        resultPage.classList.add('preview-mode');
        currentSettings = loadCustomSettings();
        updatePreviewWithCode("7131");
        applyCustomSettings(currentSettings);
    });

    customizeBack.addEventListener('click', function() {
        customizePage.classList.remove('visible', 'preview-mode');
        resultPage.classList.remove('preview-mode');
        settingsPage.classList.add('visible');
        isPreviewMode = false;
        currentSettings = loadCustomSettings();
        applyCustomSettings(currentSettings);
    });
    customizeNoteBack.addEventListener('click', function() {
        customizeNotePage.classList.remove('visible', 'preview-mode');
        settingsPage.classList.add('visible');
        currentNoteSettings = loadNoteSettings();
        applyNoteSettings(currentNoteSettings);
    });

    customizeSave.addEventListener('click', function() {
        saveCustomSettings(currentSettings);
        customizePage.classList.remove('visible', 'preview-mode');
        resultPage.classList.remove('preview-mode');
        settingsPage.classList.add('visible');
        isPreviewMode = false;
    });

    customizeNoteSave.addEventListener('click', function() {        saveNoteSettings(currentNoteSettings);
        customizeNotePage.classList.remove('visible', 'preview-mode');
        settingsPage.classList.add('visible');
    });

    customizeReset.addEventListener('click', function() {
        currentSettings = JSON.parse(JSON.stringify(defaultSettings));
        applyCustomSettings(currentSettings);
    });

    customizeNoteReset.addEventListener('click', function() {
        currentNoteSettings = JSON.parse(JSON.stringify(defaultNoteSettings));
        applyNoteSettings(currentNoteSettings);
    });

    settingsBack.addEventListener('click', function() {
        settingsPage.classList.remove('visible');
        homePage.classList.remove('hidden');
        previewContainer.classList.remove('visible');
    });

    modalOverlay.addEventListener('click', function() {
        modal.classList.remove('visible');
        modalOverlay.classList.remove('visible');
        searchInput.blur();
        keyboardVisible = false;
        modal.classList.remove('keyboard-open');
        resetModalToNormal();
    });

    function updateDots() {
        for (var i = 0; i < dots.length; i++) {
            if (i < pin.length) dots[i].classList.add('active');
            else dots[i].classList.remove('active');
        }
    }

    function resetModalToNormal() {
        searchInput.value = '';
        codeResult.textContent = '';
        codeResult.classList.remove('error');
        enableSearchButton();
        keyboardVisible = false;
        modal.classList.remove('keyboard-open');
    }

    function animateKey(element) {
        if (!element) return;
        element.classList.add('active');
        setTimeout(function() { element.classList.remove('active'); }, 350);    }

    for (var i = 0; i < keys.length; i++) {
        keys[i].addEventListener('click', function() {
            animateKey(this);
            if (pin.length < 4) {
                var numberSpan = this.querySelector('.key-number');
                pin += numberSpan ? numberSpan.innerText : this.innerText;
                updateDots();
            }
        });
    }

    deleteBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (deleteBtn.classList) deleteBtn.classList.add('active-text');
        setTimeout(function() { if (deleteBtn.classList) deleteBtn.classList.remove('active-text'); }, 350);
        if (pin.length > 0) {
            pin = pin.slice(0, -1);
            updateDots();
        }
    });

    okBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (okBtn.classList) okBtn.classList.add('active-text');
        setTimeout(function() { if (okBtn.classList) okBtn.classList.remove('active-text'); }, 350);
        if (pin.length === 4) {
            currentCode = pin;
            updatePreviewWithCode(pin);
            lockPage.classList.remove('visible');
            resultPage.classList.add('visible');
            pin = '';
            updateDots();
        }
    });

    emergencyBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (emergencyBtn.classList) emergencyBtn.classList.add('active-text');
        setTimeout(function() { if (emergencyBtn.classList) emergencyBtn.classList.remove('active-text'); }, 350);
        lockPage.classList.remove('visible');
        homePage.classList.remove('hidden');
        pin = '';
        updateDots();
    });

    indexDisplay.addEventListener('click', function(e) {
        e.stopPropagation();
        indexClickCount++;        
        if (indexClickCount === 1) {
            indexClickTimer = setTimeout(function() {
                wordsContainer.classList.toggle('hidden');
                lettersContainer.classList.toggle('hidden');
                indexClickCount = 0;
            }, 300);
        } else if (indexClickCount === 2) {
            clearTimeout(indexClickTimer);
            noteModeActive = !noteModeActive;
            if (noteModeActive) {
                indexDisplay.classList.add('note-mode-active');
            } else {
                indexDisplay.classList.remove('note-mode-active');
            }
            indexClickCount = 0;
        }
    });

    notePage.addEventListener('click', function(e) {
        var now = Date.now();
        if (now - noteLastTap < 300 && now - noteLastTap > 0) {
            notePage.classList.remove('visible');
            noteText.contentEditable = "false";
            resetAfterNotePageClose();
            noteLastTap = 0;
        } else {
            noteLastTap = now;
        }
    });

    resultPage.addEventListener('click', function(e) {
        if (e.target.classList.contains('result-word') || e.target.classList.contains('letter-btn') || e.target === indexDisplay) return;
        var now = Date.now();
        if (now - lastTap < 300 && now - lastTap > 0) {
            resultPage.classList.remove('visible');
            lockPage.classList.add('visible');
            selectedLetter = '';
        }
        lastTap = now;
    });

    function setupImageImport(input, target, storageKey) {
        input.addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(event) {
                    currentPreviewData = event.target.result;
                    previewImage.src = currentPreviewData;                    previewContainer.classList.add('visible');
                    currentPreviewTarget = target === lockPage ? 'bg' : (target === resultPage ? 'img' : 'note');
                };
                reader.readAsDataURL(file);
            }
        });
    }

    try {
        var savedBg = localStorage.getItem('backgroundImage');
        if (savedBg) lockPage.style.backgroundImage = 'url(' + savedBg + ')';
        var savedImg = localStorage.getItem('resultImage');
        if (savedImg) resultPage.style.backgroundImage = 'url(' + savedImg + ')';
        var savedNote = localStorage.getItem('noteImage');
        if (savedNote) {
            customizeNotePage.style.backgroundImage = 'url(' + savedNote + ')';
            notePage.style.backgroundImage = 'url(' + savedNote + ')';
        }
    } catch(e) {}

    setupImageImport(bgFileInput, lockPage, 'backgroundImage');
    setupImageImport(imgFileInput, resultPage, 'resultImage');
    setupImageImport(noteFileInput, customizeNotePage, 'noteImage');
    
    importBgBtn.addEventListener('click', function() { bgFileInput.click(); });
    importImgBtn.addEventListener('click', function() { imgFileInput.click(); });
    importNoteBtn.addEventListener('click', function() { noteFileInput.click(); });

    previewConfirm.addEventListener('click', function() {
        if (currentPreviewTarget === 'bg') {
            lockPage.style.backgroundImage = 'url(' + currentPreviewData + ')';
            try { localStorage.setItem('backgroundImage', currentPreviewData); } catch(e) {}
        } else if (currentPreviewTarget === 'img') {
            resultPage.style.backgroundImage = 'url(' + currentPreviewData + ')';
            try { localStorage.setItem('resultImage', currentPreviewData); } catch(e) {}
        } else if (currentPreviewTarget === 'note') {
            customizeNotePage.style.backgroundImage = 'url(' + currentPreviewData + ')';
            notePage.style.backgroundImage = 'url(' + currentPreviewData + ')';
            try { localStorage.setItem('noteImage', currentPreviewData); } catch(e) {}
        }
        previewContainer.classList.remove('visible');
        currentPreviewData = '';
    });

    previewCancel.addEventListener('click', function() {
        previewContainer.classList.remove('visible');
        currentPreviewData = '';
    });

    currentSettings = loadCustomSettings();    applyCustomSettings(currentSettings);
    currentNoteSettings = loadNoteSettings();
    applyNoteSettings(currentNoteSettings);
    updateDots();
    resetModalToNormal();
    
    const title = document.querySelector('.app-title');
    if (title) {
        title.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); return false; });
        title.addEventListener('selectstart', (e) => { e.preventDefault(); return false; });
    }
    
    window.addEventListener('load', () => {
        const letters = document.querySelectorAll('.app-title .letter');
        letters.forEach((letter, i) => {
            letter.style.opacity = '0';
            letter.style.transform = 'translateY(15px)';
            setTimeout(() => {
                letter.style.transition = 'opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                letter.style.opacity = '1';
                letter.style.transform = 'translateY(0)';
            }, 100 + (i * 60));
        });
    });
})();
    </script>
</body>
</html>
